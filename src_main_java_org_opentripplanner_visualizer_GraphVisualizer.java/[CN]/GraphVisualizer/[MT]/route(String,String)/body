{
  Date when;
  try {
    when=dateFormat.parse(searchDate.getText());
  }
 catch (  ParseException e) {
    searchDate.setText("Format: " + dateFormat.toPattern());
    return;
  }
  TraverseModeSet modeSet=new TraverseModeSet();
  modeSet.setWalk(walkCheckBox.isSelected());
  modeSet.setBicycle(bikeCheckBox.isSelected());
  modeSet.setFerry(ferryCheckBox.isSelected());
  modeSet.setTrainish(trainCheckBox.isSelected());
  modeSet.setBusish(busCheckBox.isSelected());
  modeSet.setCar(carCheckBox.isSelected());
  modeSet.setCustomMotorVehicle(cmvCheckBox.isSelected());
  if (transitCheckBox.isSelected())   modeSet.setTransit(true);
  RoutingRequest options=new RoutingRequest(modeSet);
  options.setArriveBy(arriveByCheckBox.isSelected());
  options.setWalkBoardCost(Integer.parseInt(boardingPenaltyField.getText()) * 60);
  options.setBikeBoardCost(Integer.parseInt(boardingPenaltyField.getText()) * 60 * 2);
  options.setOptimize(getSelectedOptimizeType());
  options.setMaxWalkDistance(Integer.parseInt(maxWalkField.getText()));
  options.setDateTime(when);
  options.setFromString(from);
  options.setToString(to);
  options.walkSpeed=Float.parseFloat(walkSpeed.getText());
  options.bikeSpeed=Float.parseFloat(bikeSpeed.getText());
  options.heuristicWeight=(Float.parseFloat(heuristicWeight.getText()));
  options.softWalkLimiting=(softWalkLimiting.isSelected());
  options.softWalkPenalty=(Float.parseFloat(softWalkPenalty.getText()));
  options.softWalkOverageRate=(Float.parseFloat(this.softWalkOverageRate.getText()));
  options.numItineraries=1;
  System.out.println("--------");
  System.out.println("Path from " + from + " to "+ to+ " at "+ when);
  System.out.println("\tModes: " + modeSet);
  System.out.println("\tOptions: " + options);
  options.numItineraries=(Integer.parseInt(this.nPaths.getText()));
  if (dontUseGraphicalCallbackCheckBox.isSelected()) {
    sptServiceFactory.setTraverseVisitor(null);
  }
 else {
    sptServiceFactory.setTraverseVisitor(new VisualTraverseVisitor(showGraph));
  }
  SPTVisitor vis=new SPTVisitor();
  long t0=System.currentTimeMillis();
  List<GraphPath> paths=pathservice.getPaths(options);
  long dt=System.currentTimeMillis() - t0;
  searchTimeElapsedLabel.setText("search time elapsed: " + dt + "ms");
  spt=vis.spt;
  showGraph.setSPT(spt);
  System.out.println("got spt:" + spt);
  if (paths == null) {
    System.out.println("no path");
    showGraph.highlightGraphPath(null);
    return;
  }
  showGraph.simpleSPT.setWeights();
  showPathsInPanel(paths);
  showGraph.setSPTFlattening(Float.parseFloat(sptFlattening.getText()));
  showGraph.setSPTThickness(Float.parseFloat(sptThickness.getText()));
  showGraph.redraw();
  options.cleanup();
}
