{
  TimeZone timeZone=cs.getTimeZoneForAgencyId(agencyId);
  GregorianCalendar calendar=new GregorianCalendar(timeZone);
  calendar.setTime(new Date(time * 1000));
  serviceDate=new ServiceDate(calendar);
  Date d=serviceDate.getAsDate(timeZone);
  this.midnight=d.getTime() / 1000;
  serviceIdsRunning=new BitSet(cs.getServiceIds().size());
  ServiceIdToNumberService service=graph.getService(ServiceIdToNumberService.class);
  for (  AgencyAndId serviceId : cs.getServiceIdsOnDate(serviceDate)) {
    int n=service.getNumber(serviceId);
    if (n < 0)     continue;
    serviceIdsRunning.set(n);
  }
}
