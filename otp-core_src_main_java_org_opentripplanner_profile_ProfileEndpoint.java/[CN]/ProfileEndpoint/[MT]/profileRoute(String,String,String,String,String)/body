{
  if (data == null)   data=new ProfileData(graphService.getGraph());
  try {
    ServiceDate date;
    if (dateString == null || dateString.isEmpty()) {
      date=new ServiceDate();
    }
 else {
      date=ServiceDate.parseString(dateString);
    }
    String[] fromFields=from.split(",");
    String[] toFields=to.split(",");
    double fromLat=Double.parseDouble(fromFields[0]);
    double fromLon=Double.parseDouble(fromFields[1]);
    double toLat=Double.parseDouble(toFields[0]);
    double toLon=Double.parseDouble(toFields[1]);
    int fromTime=secondsFromString(fromTimeString);
    int toTime=secondsFromString(toTimeString);
    ProfileRouter router=new ProfileRouter(data);
    ProfileResponse pr=new ProfileResponse(router.route(fromLat,fromLon,toLat,toLon,fromTime,toTime,date));
    return Response.status(Status.OK).entity(pr).build();
  }
 catch (  ParseException pe) {
    return Response.status(Status.BAD_REQUEST).entity("Error parsing parameter.").build();
  }
catch (  NumberFormatException pe) {
    return Response.status(Status.BAD_REQUEST).entity("Number format error.").build();
  }
catch (  NullPointerException npe) {
    return Response.status(Status.BAD_REQUEST).entity("Missing parameter.").build();
  }
catch (  ArrayIndexOutOfBoundsException aioobe) {
    return Response.status(Status.BAD_REQUEST).entity("Malformed parameter.").build();
  }
}
