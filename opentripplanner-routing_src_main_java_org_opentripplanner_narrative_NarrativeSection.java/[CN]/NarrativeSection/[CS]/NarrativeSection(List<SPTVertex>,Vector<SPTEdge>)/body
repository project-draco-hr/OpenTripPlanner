{
  SPTVertex first=vertices.get(0);
  startTime=first.state.getTime();
  SPTVertex last=vertices.get(vertices.size() - 1);
  endTime=last.state.getTime();
  items=new Vector<NarrativeItem>();
  Edge graphEdge=edges.firstElement().payload;
  mode=graphEdge.getMode();
  direction=graphEdge.getDirection();
  LineMerger merger=new LineMerger();
  GeometryFactory factory=null;
  for (  SPTEdge edge : edges) {
    Geometry geom=edge.payload.getGeometry();
    if (geom != null) {
      merger.add(geom);
      factory=geom.getFactory();
    }
  }
  if (factory != null) {
    Collection collection=merger.getMergedLineStrings();
    geometry=factory.buildGeometry(collection);
  }
  if (graphEdge instanceof Hop || graphEdge instanceof PatternHop) {
    name=graphEdge.getName();
    direction=graphEdge.getDirection();
    BasicNarrativeItem item=new BasicNarrativeItem();
    item.setDirection(graphEdge.getDirection());
    item.setName(graphEdge.getName());
    String end=graphEdge.getEnd();
    double totalDistance=graphEdge.getDistance();
    merger=new LineMerger();
    for (    SPTEdge edge : edges.subList(1,edges.size())) {
      graphEdge=edge.payload;
      totalDistance+=graphEdge.getDistance();
      Geometry geom=edge.payload.getGeometry();
      if (geom != null) {
        merger.add(geom);
        factory=geom.getFactory();
      }
      end=graphEdge.getEnd();
    }
    if (factory != null) {
      Collection collection=merger.getMergedLineStrings();
      item.setGeometry(factory.buildGeometry(collection));
    }
    item.setDistance(totalDistance);
    item.setEnd(end);
    items.add(item);
  }
 else   if (graphEdge instanceof Street) {
    name="walk";
    Street street1=(Street)edges.firstElement().payload;
    Street street2=(Street)edges.lastElement().payload;
    direction=Street.computeDirection(street1.getGeometry().getStartPoint(),street2.getGeometry().getEndPoint());
    double totalDistance=0;
    String lastStreet=null;
    BasicNarrativeItem item=null;
    for (    SPTEdge edge : edges) {
      graphEdge=edge.payload;
      String streetName=graphEdge.getName();
      if (streetName == lastStreet) {
        totalDistance+=graphEdge.getDistance();
        item.setDistance(totalDistance);
        item.setGeometry(item.getGeometry().union(graphEdge.getGeometry()));
        item.setEnd(graphEdge.getStart());
        continue;
      }
      item=new BasicNarrativeItem();
      item.setName(streetName);
      item.setDirection(graphEdge.getDirection());
      item.setGeometry(graphEdge.getGeometry());
      item.setStart(graphEdge.getStart());
      item.setEnd(graphEdge.getEnd());
      items.add(item);
    }
  }
}
