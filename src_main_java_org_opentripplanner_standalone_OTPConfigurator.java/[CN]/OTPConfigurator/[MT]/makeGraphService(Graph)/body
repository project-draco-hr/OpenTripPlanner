{
  if (graph != null && (params.inMemory || params.preFlight)) {
    try {
      FileInputStream graphConfiguration=new FileInputStream(params.graphConfigFile);
      Preferences config=new PropertiesPreferences(graphConfiguration);
      this.graphService=new GraphServiceBeanImpl(graph,config);
    }
 catch (    Exception e) {
      if (params.graphConfigFile != null)       LOG.error("Can't read config file",e);
      this.graphService=new GraphServiceBeanImpl(graph,null);
    }
  }
 else {
    GraphServiceImpl graphService=new GraphServiceImpl();
    if (params.graphDirectory != null) {
      graphService.setPath(params.graphDirectory);
    }
    if (params.routerIds.size() > 0) {
      graphService.setDefaultRouterId(params.routerIds.get(0));
      graphService.setAutoRegister(params.routerIds);
    }
    graphService.startup();
    this.graphService=graphService;
  }
}
