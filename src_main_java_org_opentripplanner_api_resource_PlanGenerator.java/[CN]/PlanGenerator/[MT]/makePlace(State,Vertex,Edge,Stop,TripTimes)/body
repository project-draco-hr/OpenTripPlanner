{
  boolean endOfLeg=(edge == null);
  Place place=new Place(vertex.getX(),vertex.getY(),vertex.getName(),makeCalendar(state),makeCalendar(state));
  if (endOfLeg)   edge=state.getBackEdge();
  if (vertex instanceof TransitVertex && edge instanceof OnboardEdge) {
    place.stopId=stop.getId();
    place.stopCode=stop.getCode();
    place.platformCode=stop.getPlatformCode();
    place.zoneId=stop.getZoneId();
    place.stopIndex=((OnboardEdge)edge).getStopIndex();
    if (endOfLeg)     place.stopIndex++;
    if (tripTimes != null) {
      place.stopSequence=tripTimes.getStopSequence(place.stopIndex);
    }
  }
  return place;
}
