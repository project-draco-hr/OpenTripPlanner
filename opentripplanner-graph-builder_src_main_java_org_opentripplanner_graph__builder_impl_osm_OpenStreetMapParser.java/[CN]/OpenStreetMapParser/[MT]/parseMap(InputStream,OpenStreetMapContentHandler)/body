{
  try {
    DocumentBuilder builder=DocumentBuilderFactory.newInstance().newDocumentBuilder();
    Document doc=builder.parse(in);
    Node osm=doc.getFirstChild();
    Node node=osm.getFirstChild();
    while (node != null) {
      if (!(node instanceof Element)) {
        node=node.getNextSibling();
        continue;
      }
      Element element=(Element)node;
      if (element.getTagName().equals("node")) {
        OSMNode osmNode=new OSMNode();
        osmNode.setId(Long.parseLong(element.getAttribute("id")));
        osmNode.setLat(Double.parseDouble(element.getAttribute("lat")));
        osmNode.setLon(Double.parseDouble(element.getAttribute("lon")));
        processTags(osmNode,element);
        map.addNode(osmNode);
      }
 else       if (element.getTagName().equals("way")) {
        OSMWay osmWay=new OSMWay();
        osmWay.setId(Long.parseLong(element.getAttribute("id")));
        processTags(osmWay,element);
        Node node2=element.getFirstChild();
        while (node2 != null) {
          if (!(node2 instanceof Element)) {
            node2=node2.getNextSibling();
            continue;
          }
          Element element2=(Element)node2;
          if (element2.getNodeName().equals("nd")) {
            OSMNodeRef nodeRef=new OSMNodeRef();
            nodeRef.setRef(Long.parseLong(element2.getAttribute("ref")));
            osmWay.addNodeRef(nodeRef);
          }
          node2=node2.getNextSibling();
        }
        map.addWay(osmWay);
      }
      node=node.getNextSibling();
    }
  }
 catch (  ParserConfigurationException e) {
    throw new RuntimeException(e);
  }
}
