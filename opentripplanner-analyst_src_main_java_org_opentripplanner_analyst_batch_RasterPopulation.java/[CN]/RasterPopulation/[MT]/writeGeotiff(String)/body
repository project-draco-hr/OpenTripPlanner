{
  LOG.info("writing geotiff.");
  BufferedImage image=new BufferedImage(width,height,BufferedImage.TYPE_USHORT_GRAY);
  short[] imagePixelData=((DataBufferUShort)image.getRaster().getDataBuffer()).getData();
  int i=0;
  double maxOutput=0;
  for (  Individual indiv : this.getIndividuals()) {
    if (indiv.output > maxOutput)     maxOutput=indiv.output;
  }
  for (  Individual indiv : this.getIndividuals()) {
    int pixel=(int)(indiv.output / maxOutput * 65535);
    if (pixel < 0)     pixel=0;
    if (pixel > 65535)     pixel=65535;
    imagePixelData[i]=(short)pixel;
    i++;
  }
  this.cov=new GridCoverageFactory().create(cov.getName(),image,cov.getEnvelope());
  try {
    GeoTiffWriteParams wp=new GeoTiffWriteParams();
    wp.setCompressionMode(GeoTiffWriteParams.MODE_EXPLICIT);
    wp.setCompressionType("LZW");
    ParameterValueGroup params=new GeoTiffFormat().getWriteParameters();
    params.parameter(AbstractGridFormat.GEOTOOLS_WRITE_PARAMS.getName().toString()).setValue(wp);
    new GeoTiffWriter(new File(fileName)).write(this.cov,(GeneralParameterValue[])params.values().toArray(new GeneralParameterValue[1]));
  }
 catch (  Exception e) {
    LOG.error("exception while writing geotiff.");
    e.printStackTrace();
  }
  LOG.info("done writing geotiff.");
}
