{
  Timetable timetable=scheduledTimetable;
  TimetableResolver snapshot=options.rctx.timetableSnapshot;
  if (snapshot != null)   timetable=snapshot.resolve(this);
  int mask=boarding ? TableTripPattern.MASK_PICKUP : MASK_DROPOFF;
  int shift=boarding ? SHIFT_PICKUP : SHIFT_DROPOFF;
  int stopOffset=boarding ? 0 : 1;
  if ((perStopFlags[stopIndex + stopOffset] & mask) >> shift == NO_PICKUP) {
    return null;
  }
  if (options.wheelchairAccessible && (perStopFlags[stopIndex + stopOffset] & FLAG_WHEELCHAIR_ACCESSIBLE) == 0) {
    return null;
  }
  return timetable.getNextTrip(stopIndex,time,haveBicycle,options,boarding,adjacentTimes);
}
