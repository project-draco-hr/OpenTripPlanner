{
  _log.debug("constructing index...");
  StreetVertexIndexServiceImpl index=new StreetVertexIndexServiceImpl(graph);
  index.setup();
  _log.debug("creating linkages...");
  int i=0;
  ArrayList<Vertex> vertices=new ArrayList<Vertex>(graph.getVertices());
  for (  Vertex v : vertices) {
    if (i % 500 == 0)     _log.debug("vertices=" + i + "/"+ vertices.size());
    i++;
    if (v instanceof TransitStop) {
      Vertex nearestIntersection=index.getClosestVertex(v.getCoordinate(),false);
      if (nearestIntersection != null) {
        if (nearestIntersection instanceof StreetLocation) {
          nearestIntersection=((StreetLocation)nearestIntersection).reify(graph);
        }
        TransitStop ts=(TransitStop)v;
        boolean wheelchairAccessible=ts.hasWheelchairEntrance();
        graph.addEdge(new StreetTransitLink(nearestIntersection,v,wheelchairAccessible));
        graph.addEdge(new StreetTransitLink(v,nearestIntersection,wheelchairAccessible));
      }
    }
  }
}
