{
  int scheduleTime=useArrival ? end.getArrivalTime() : start.getDepartureTime();
  Calendar c=Calendar.getInstance();
  c.setTimeInMillis(currentTime);
  c.set(Calendar.HOUR_OF_DAY,0);
  c.set(Calendar.MINUTE,0);
  c.set(Calendar.SECOND,0);
  c.set(Calendar.MILLISECOND,0);
  int dayOverflow=scheduleTime / SECS_IN_DAY;
  c.add(Calendar.DAY_OF_YEAR,-dayOverflow);
  return c.getTime();
}
