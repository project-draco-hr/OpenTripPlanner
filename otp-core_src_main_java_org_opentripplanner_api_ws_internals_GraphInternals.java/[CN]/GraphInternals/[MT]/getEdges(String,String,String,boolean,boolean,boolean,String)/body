{
  initIndexes(routerId);
  if (className != null && className.equals(""))   className=null;
  Envelope envelope=getEnvelope(lowerLeft,upperRight);
  EdgeSet out=new EdgeSet();
  Graph graph=graphService.getGraph(routerId);
  STRtree edgeIndex=edgeIndices.get(routerId);
  @SuppressWarnings("unchecked") List<Edge> query=edgeIndex.query(envelope);
  out.edges=new ArrayList<WrappedEdge>();
  for (  Edge e : query) {
    if (skipStreets && (e instanceof StreetEdge))     continue;
    if (skipTransit && !(e instanceof StreetEdge))     continue;
    if (skipNoGeometry && e.getGeometry() == null)     continue;
    if (className != null && !e.getClass().getName().endsWith("." + className))     continue;
    out.edges.add(new WrappedEdge(e,graph.getIdForEdge(e)));
  }
  return out.withGraph(graph);
}
