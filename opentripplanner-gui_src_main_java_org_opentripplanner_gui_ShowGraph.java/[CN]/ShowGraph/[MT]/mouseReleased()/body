{
  if (startDragX == -1 || startDragY == -1 || Math.abs(mouseX - startDragX) < 5 || Math.abs(mouseY - startDragY) < 5) {
    startDragX=startDragY=-1;
    return;
  }
  double x1=toModelX(startDragX);
  double x2=toModelX(mouseX);
  if (x1 > x2) {
    double tmp=x1;
    x1=x2;
    x2=tmp;
  }
  double y1=toModelY(startDragY);
  double y2=toModelY(mouseY);
  if (y1 > y2) {
    double tmp=y1;
    y1=y2;
    y2=tmp;
  }
  double yDist=y2 - y1;
  double xDist=x2 - x1;
  if (yDist < 0.00001 || xDist < 0.00001) {
    startDragX=startDragY=-1;
    return;
  }
  double originalAspectRatio=modelOuterBounds.getWidth() / modelOuterBounds.getHeight();
  double zoomBoxAspectRatio=xDist / yDist;
  if (zoomBoxAspectRatio > originalAspectRatio) {
    double desiredYDist=yDist * zoomBoxAspectRatio / originalAspectRatio;
    y1-=(desiredYDist - yDist) / 2;
    y2+=(desiredYDist - yDist) / 2;
  }
 else {
    double desiredXDist=xDist * originalAspectRatio / zoomBoxAspectRatio;
    x1-=(desiredXDist - xDist) / 2;
    x2+=(desiredXDist - xDist) / 2;
  }
  modelBounds=new Envelope(x1,x2,y1,y2);
}
