{
  Map<String,String> tags=entity.getTags();
  StreetTraversalPermission def=null;
  StreetTraversalPermission permission=null;
  for (  KeyValuePermission kvp : _tagPermissions.values()) {
    if (tags.containsKey(kvp.key) && kvp.value.equals(tags.get(kvp.key))) {
      def=kvp.permission;
      break;
    }
  }
  if (def == null) {
    if (_tagPermissions.containsKey("__default__")) {
      String all_tags=null;
      for (      String key : tags.keySet()) {
        String tag=key + "=" + tags.get(key);
        if (all_tags == null) {
          all_tags=tag;
        }
 else {
          all_tags+="; " + tag;
        }
      }
      _log.debug("Used default permissions: " + all_tags);
      def=_tagPermissions.get("__default__").permission;
    }
 else {
      def=StreetTraversalPermission.ALL;
    }
  }
  String access=tags.get("access");
  String motorcar=tags.get("motorcar");
  String bicycle=tags.get("bicycle");
  String foot=tags.get("foot");
  if (access != null) {
    if ("no".equals(access) || "private".equals(access)) {
      permission=StreetTraversalPermission.NONE;
    }
 else {
      permission=def;
    }
  }
 else   if (motorcar != null || bicycle != null || foot != null) {
    permission=def;
  }
  if (motorcar != null) {
    if ("no".equals(motorcar) || "private".equals(motorcar)) {
      permission=permission.remove(StreetTraversalPermission.CAR);
    }
 else {
      permission=permission.add(StreetTraversalPermission.CAR);
    }
  }
  if (bicycle != null) {
    if ("no".equals(bicycle) || "private".equals(bicycle)) {
      permission=permission.remove(StreetTraversalPermission.BICYCLE);
    }
 else {
      permission=permission.add(StreetTraversalPermission.BICYCLE);
    }
  }
  if (foot != null) {
    if ("no".equals(foot) || "private".equals(foot)) {
      permission=permission.remove(StreetTraversalPermission.PEDESTRIAN);
    }
 else {
      permission=permission.add(StreetTraversalPermission.PEDESTRIAN);
    }
  }
  if (permission == null)   return def;
  return permission;
}
