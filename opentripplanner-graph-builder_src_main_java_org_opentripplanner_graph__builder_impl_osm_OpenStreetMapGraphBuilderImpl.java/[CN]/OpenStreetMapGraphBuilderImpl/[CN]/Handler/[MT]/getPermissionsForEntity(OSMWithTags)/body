{
  Map<String,String> tags=entity.getTags();
  StreetTraversalPermission def=null;
  StreetTraversalPermission permission=null;
  String access=tags.get("access");
  String motorcar=tags.get("motorcar");
  String bicycle=tags.get("bicycle");
  String foot=tags.get("foot");
  String all_tags=access != null ? "access=" + access : "; ";
  all_tags+=motorcar != null ? "motorcar=" + motorcar : "; ";
  all_tags+=bicycle != null ? "bicycle=" + bicycle : "; ";
  all_tags+=foot != null ? "foot=" + foot : "; ";
  for (  KeyValuePermission kvp : _tagPermissions.values()) {
    if (tags.containsKey(kvp.key) && kvp.value.equals(tags.get(kvp.key))) {
      def=kvp.permission;
      break;
    }
  }
  if (def == null) {
    if (_tagPermissions.containsKey("__default__")) {
      def=_tagPermissions.get("__default__").permission;
      _log.debug("Used default permissions: " + all_tags);
    }
 else {
      def=StreetTraversalPermission.ALL;
    }
  }
  if (access != null) {
    if ("no".equals(access)) {
      permission=StreetTraversalPermission.NONE;
    }
 else {
      permission=StreetTraversalPermission.ALL;
    }
  }
 else   if (motorcar != null || bicycle != null || foot != null) {
    permission=def;
  }
  if (motorcar != null) {
    if ("no".equals(motorcar) || "private".equals(motorcar)) {
      permission=permission.remove(StreetTraversalPermission.CAR);
    }
 else {
      permission=permission.add(StreetTraversalPermission.CAR);
    }
  }
  if (tags.containsKey("bicycle")) {
    if ("no".equals(bicycle) || "private".equals(bicycle)) {
      permission=permission.remove(StreetTraversalPermission.BICYCLE);
    }
 else {
      permission=permission.add(StreetTraversalPermission.BICYCLE);
    }
  }
  if (foot != null) {
    if ("no".equals(foot) || "private".equals(foot)) {
      permission=permission.remove(StreetTraversalPermission.PEDESTRIAN);
    }
 else {
      permission=permission.add(StreetTraversalPermission.PEDESTRIAN);
    }
  }
  if (permission == null)   return def;
  return permission;
}
