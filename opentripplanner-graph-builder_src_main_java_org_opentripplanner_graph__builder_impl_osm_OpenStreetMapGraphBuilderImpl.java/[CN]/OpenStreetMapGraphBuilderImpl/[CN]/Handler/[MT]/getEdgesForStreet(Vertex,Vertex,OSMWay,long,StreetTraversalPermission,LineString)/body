{
  Coordinate[] coordinates=geometry.getCoordinates();
  double d=0;
  for (int i=1; i < coordinates.length; ++i) {
    d+=DistanceLibrary.distance(coordinates[i - 1],coordinates[i]);
  }
  LineString backGeometry=(LineString)geometry.reverse();
  Map<String,String> tags=way.getTags();
  if (permissions == StreetTraversalPermission.NONE)   return new P2<PlainStreetEdge>(null,null);
  PlainStreetEdge street=null, backStreet=null;
  if ("yes".equals(tags.get("oneway")) && ("no".equals(tags.get("oneway:bicycle")) || "opposite_lane".equals(tags.get("cycleway")) || "opposite".equals(tags.get("cycleway")))) {
    street=getEdgeForStreet(start,end,way,startNode,d,permissions,geometry,false);
    if (permissions.remove(StreetTraversalPermission.CAR) != StreetTraversalPermission.NONE)     backStreet=getEdgeForStreet(end,start,way,startNode,d,permissions.remove(StreetTraversalPermission.CAR),backGeometry,true);
  }
 else   if ("yes".equals(tags.get("oneway")) || "roundabout".equals(tags.get("junction"))) {
    street=getEdgeForStreet(start,end,way,startNode,d,permissions,geometry,false);
    if (permissions.allows(StreetTraversalPermission.PEDESTRIAN))     backStreet=getEdgeForStreet(end,start,way,startNode,d,StreetTraversalPermission.PEDESTRIAN,backGeometry,true);
  }
 else {
    street=getEdgeForStreet(start,end,way,startNode,d,permissions,geometry,false);
    backStreet=getEdgeForStreet(end,start,way,startNode,d,permissions,backGeometry,true);
  }
  if ("roundabout".equals(tags.get("junction"))) {
    street.setRoundabout(true);
    if (backStreet != null)     backStreet.setRoundabout(true);
  }
  for (  Map.Entry<P2<String>,P2<Double>> feature : safetyFeatures.entrySet()) {
    String key=feature.getKey().getFirst();
    String value=feature.getKey().getSecond();
    if (value.equals(tags.get(key))) {
      P2<Double> multipliers=feature.getValue();
      if (street != null) {
        street.setBicycleSafetyEffectiveLength(street.getBicycleSafetyEffectiveLength() * multipliers.getFirst());
      }
      if (backStreet != null) {
        backStreet.setBicycleSafetyEffectiveLength(backStreet.getBicycleSafetyEffectiveLength() * multipliers.getSecond());
      }
    }
  }
  return new P2<PlainStreetEdge>(street,backStreet);
}
