{
  Map<EdgeWithElevation,List<ElevationPoint>> data=extraElevationData.data;
  for (  Map.Entry<EdgeWithElevation,List<ElevationPoint>> entry : data.entrySet()) {
    EdgeWithElevation edge=entry.getKey();
    List<ElevationPoint> points=entry.getValue();
    Collections.sort(points);
    if (points.size() == 1) {
      ElevationPoint firstPoint=points.get(0);
      ElevationPoint endPoint=new ElevationPoint(edge.getDistance(),firstPoint.ele);
      points.add(endPoint);
    }
    Coordinate[] coords=new Coordinate[points.size()];
    int i=0;
    for (    ElevationPoint p : points) {
      double d=p.distanceAlongShape;
      if (i == 0) {
        d=0;
      }
 else       if (i == points.size() - 1) {
        d=edge.getDistance();
      }
      coords[i++]=new Coordinate(d,p.ele);
    }
    if (edge.setElevationProfile(new PackedCoordinateSequence.Double(coords),true)) {
      _log.warn(graph.addBuilderAnnotation(new ElevationFlattened(edge)));
    }
  }
}
