{
  try {
    String baseAddress=this.transitServerGtfs.getGeoserverBaseUri();
    UriBuilder uriBuilder=null;
    try {
      uriBuilder=UriBuilder.fromUri(baseAddress);
      MultivaluedMap<String,String> queryParams=ui.getQueryParameters();
      for (      Entry<String,List<String>> entrySet : queryParams.entrySet()) {
        String key=entrySet.getKey();
        List<String> vals=entrySet.getValue();
        String val=vals.get(0);
        if (vals.size() > 1) {
          System.out.println("*** got more than one value for: " + key + " - using first: "+ val);
        }
        uriBuilder.queryParam(key,val);
      }
    }
 catch (    IllegalArgumentException e) {
      e.printStackTrace();
      throw new WebApplicationException(400);
    }
    URI uri=uriBuilder.build();
    String urlString=uri.toString();
    URL url=new URL(urlString);
    URLConnection conn=url.openConnection();
    BufferedReader reader=new BufferedReader(new InputStreamReader(conn.getInputStream()));
    Pattern pattern=Pattern.compile("(stops|routes).(\\S+)");
    String line=null;
    List<String> stopIds=new ArrayList<String>();
    List<String> routeIds=new ArrayList<String>();
    while ((line=reader.readLine()) != null) {
      Matcher m=pattern.matcher(line);
      while (m.find()) {
        String matchType=m.group(1);
        if (matchType.equals("stops")) {
          stopIds.add(m.group(2));
        }
 else         if (matchType.equals("routes")) {
          routeIds.add(m.group(2));
        }
      }
    }
    reader.close();
    if (stopIds.size() > 0) {
      String stopId=stopIds.get(0);
      return new WmsInfo(transitServerGtfs,new AgencyAndId("MTA NYCT",stopId));
    }
 else     if (routeIds.size() > 0) {
      List<String> routeIdsWithAgencyId=new ArrayList<String>();
      for (      String routeId : routeIds) {
        routeIdsWithAgencyId.add("MTA NYCT " + routeId);
      }
      return new WmsInfo(transitServerGtfs,routeIdsWithAgencyId);
    }
  }
 catch (  MalformedURLException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
  }
  return new WmsInfo();
}
