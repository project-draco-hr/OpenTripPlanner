{
  GraphServiceImpl graphService=new GraphServiceImpl();
  FileGraphSourceFactory graphSourceFactory=new FileGraphSourceFactory();
  graphSourceFactory.basePath=basePath;
  graphSourceFactory.save("A",new ByteArrayInputStream(emptyGraphData));
  assertTrue(new File(new File(basePath,"A"),InputStreamGraphSource.GRAPH_FILENAME).canRead());
  boolean registered=graphService.registerGraph("A",graphSourceFactory.createGraphSource("A"));
  assertTrue(registered);
  Graph graph=graphService.getGraph("A");
  assertNotNull(graph);
  assertEquals("A",graph.routerId);
  assertEquals(0,graph.getVertices().size());
  assertEquals(1,graphService.getRouterIds().size());
  int verticesCount=smallGraph.getVertices().size();
  int edgesCount=smallGraph.getEdges().size();
  graphSourceFactory.save("A",new ByteArrayInputStream(smallGraphData));
  graphService.reloadGraphs(false);
  graph=graphService.getGraph("A");
  assertEquals(verticesCount,graph.getVertices().size());
  assertEquals(edgesCount,graph.getEdges().size());
  boolean deleted=new File(new File(basePath,"A"),InputStreamGraphSource.GRAPH_FILENAME).delete();
  assertTrue(deleted);
  graphService.reloadGraphs(false);
  assertEquals(0,graphService.getRouterIds().size());
  registered=graphService.registerGraph("A",graphSourceFactory.createGraphSource("A"));
  assertFalse(registered);
  assertEquals(0,graphService.getRouterIds().size());
  graphSourceFactory.save("A",new ByteArrayInputStream(smallGraphData));
  registered=graphService.registerGraph("A",graphSourceFactory.createGraphSource("A"));
  assertTrue(registered);
  assertEquals(1,graphService.getRouterIds().size());
  boolean evicted=graphService.evictGraph("A");
  assertTrue(evicted);
  assertEquals(0,graphService.getRouterIds().size());
}
