{
  List<TripUpdateList> tripUpdateLists=updateStreamer.getUpdates();
  if (tripUpdateLists == null) {
    LOG.debug("updates is null");
    return;
  }
  LOG.debug("message contains {} trip update blocks",tripUpdateLists.size());
  int uIndex=0;
  for (  TripUpdateList tripUpdateList : tripUpdateLists) {
    uIndex+=1;
    LOG.debug("trip update block #{} ({} updates) :",uIndex,tripUpdateList.getUpdates().size());
    LOG.trace("{}",tripUpdateList.toString());
    boolean applied=false;
switch (tripUpdateList.getStatus()) {
case ADDED:
      applied=handleAddedTrip(tripUpdateList);
    break;
case CANCELED:
  applied=handleCanceledTrip(tripUpdateList);
break;
case MODIFIED:
applied=handleModifiedTrip(tripUpdateList);
break;
case REMOVED:
applied=handleRemovedTrip(tripUpdateList);
break;
}
if (applied) {
appliedBlockCount++;
}
 else {
LOG.warn("Failed to apply TripUpdateList: " + tripUpdateList);
}
if (appliedBlockCount % logFrequency == 0) {
LOG.info("Applied {} stoptime update blocks.",appliedBlockCount);
}
}
LOG.debug("end of update message");
if (purgeExpiredData) {
boolean modified=purgeExpiredData();
getSnapshot(modified);
}
 else {
getSnapshot();
}
}
