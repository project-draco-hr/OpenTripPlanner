{
  String sourceType=preferences.get("sourceType",null);
  UpdateStreamer streamer=null;
  if (sourceType != null) {
    if (sourceType.equals("gtfs-http")) {
      streamer=new GtfsRealtimeHttpUpdateStreamer();
    }
 else     if (sourceType.equals("gtfs-zmq")) {
      streamer=new GTFSZMQUpdateStreamer();
    }
 else     if (sourceType.equals("kv8-zmq")) {
      streamer=new KV8ZMQUpdateStreamer();
    }
  }
  if (streamer == null) {
    throw new IllegalArgumentException("Unknown update streamer source type: " + sourceType);
  }
 else   if (streamer instanceof PreferencesConfigurable) {
    ((PreferencesConfigurable)streamer).configure(graph,preferences);
  }
  init(graph);
  setUpdateStreamer(streamer);
  int logFrequency=preferences.getInt("logFrequency",-1);
  if (logFrequency >= 0)   setLogFrequency(logFrequency);
  int maxSnapshotFrequency=preferences.getInt("maxSnapshotFrequencyMs",-1);
  if (maxSnapshotFrequency >= 0)   setMaxSnapshotFrequency(maxSnapshotFrequency);
  setPurgeExpiredData(preferences.getBoolean("purgeExpiredData",true));
  long frequencySec=preferences.getLong("frequencySec",DEFAULT_UPDATE_FREQ_SEC);
  LOG.info("Creating stop time updater running every {} seconds : {}",frequencySec,streamer);
}
