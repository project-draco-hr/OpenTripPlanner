{
  Response response=new Response(uriInfo);
  RoutingRequest request=null;
  try {
    request=super.buildRequest();
    Router router=otpServer.getRouter(request.routerId);
    TripPlan plan=router.planGenerator.generate(request);
    response.setPlan(plan);
  }
 catch (  Exception e) {
    PlannerError error=new PlannerError(e);
    if (!PlannerError.isPlanningError(e.getClass()))     LOG.warn("Error while planning path: ",e);
    response.setError(error);
  }
 finally {
    if (request != null) {
      response.debugOutput=request.rctx.debugOutput;
      request.cleanup();
    }
  }
  return response;
}
