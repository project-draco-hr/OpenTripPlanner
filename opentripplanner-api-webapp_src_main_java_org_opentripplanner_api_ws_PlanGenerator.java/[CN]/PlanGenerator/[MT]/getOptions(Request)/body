{
  TraverseModeSet modeSet=request.getModeSet();
  assert(modeSet.isValid());
  TraverseOptions options=new TraverseOptions(modeSet,request.getOptimize());
  options.setArriveBy(request.isArriveBy());
  options.wheelchairAccessible=request.getWheelchair();
  if (request.getMaxSlope() > 0) {
    options.maxSlope=request.getMaxSlope();
  }
  if (request.getMaxWalkDistance() > 0) {
    options.setMaxWalkDistance(request.getMaxWalkDistance());
  }
  if (request.getWalkSpeed() > 0) {
    options.speed=request.getWalkSpeed();
  }
  options.setTriangleSafetyFactor(request.getTriangleSafetyFactor());
  options.setTriangleSlopeFactor(request.getTriangleSlopeFactor());
  options.setTriangleTimeFactor(request.getTriangleTimeFactor());
  if (request.getMinTransferTime() != null) {
    options.minTransferTime=request.getMinTransferTime();
  }
  if (request.getPreferredRoutes() != null) {
    for (    String element : request.getPreferredRoutes()) {
      String[] routeSpec=element.split("_",2);
      if (routeSpec.length != 2) {
        throw new IllegalArgumentException("AgencyId or routeId not set in preferredRoutes list");
      }
      options.preferredRoutes.add(new RouteSpec(routeSpec[0],routeSpec[1]));
    }
  }
  if (request.getUnpreferredRoutes() != null) {
    for (    String element : request.getUnpreferredRoutes()) {
      String[] routeSpec=element.split("_",2);
      if (routeSpec.length != 2) {
        throw new IllegalArgumentException("AgencyId or routeId not set in unpreferredRoutes list");
      }
      options.unpreferredRoutes.add(new RouteSpec(routeSpec[0],routeSpec[1]));
    }
  }
  if (request.getBannedRoutes() != null) {
    for (    String element : request.getBannedRoutes()) {
      String[] routeSpec=element.split("_",2);
      if (routeSpec.length != 2) {
        throw new IllegalArgumentException("AgencyId or routeId not set in bannedRoutes list");
      }
      options.bannedRoutes.add(new RouteSpec(routeSpec[0],routeSpec[1]));
    }
  }
  if (request.getTransferPenalty() != null) {
    options.transferPenalty=request.getTransferPenalty();
  }
  return options;
}
