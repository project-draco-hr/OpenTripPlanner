{
  EdgeNarrative en=state.getBackEdgeNarrative();
  leg.route=en.getName();
  Trip trip=en.getTrip();
  if (trip != null) {
    leg.headsign=trip.getTripHeadsign();
    leg.tripId=trip.getId().getId();
    leg.agencyId=trip.getId().getAgencyId();
    leg.tripShortName=trip.getTripShortName();
    leg.routeShortName=trip.getRoute().getShortName();
    leg.routeLongName=trip.getRoute().getLongName();
    leg.routeColor=trip.getRoute().getColor();
    leg.routeTextColor=trip.getRoute().getTextColor();
    if (transitIndex != null) {
      Agency agency=transitIndex.getAgency(leg.agencyId);
      leg.agencyName=agency.getName();
      leg.agencyUrl=agency.getUrl();
    }
  }
  leg.mode=en.getMode().toString();
  leg.startTime=new Date(state.getBackState().getTimeInMillis());
}
