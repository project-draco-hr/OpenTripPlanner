{
  Graph graph;
  if (preEvict) {
    LOG.debug("pre-evicting graph");
    graphService.evictGraph(routerId);
  }
  if (upload) {
    LOG.debug("deserializing graph from PUT data stream...");
    try {
      graph=Graph.load(is,LoadLevel.FULL);
      graphService.registerGraph(routerId,graph);
      return Response.status(Status.CREATED).entity(graph.toString()).build();
    }
 catch (    Exception e) {
      return Response.status(Status.BAD_REQUEST).entity(e.toString()).build();
    }
  }
 else {
    LOG.debug("attempting to load graph from server's local filsystem.");
    boolean success=graphService.registerGraph(routerId,preEvict);
    if (success)     return Response.status(201).entity("graph registered.").build();
 else     return Response.status(404).entity("graph not found or other error.").build();
  }
}
