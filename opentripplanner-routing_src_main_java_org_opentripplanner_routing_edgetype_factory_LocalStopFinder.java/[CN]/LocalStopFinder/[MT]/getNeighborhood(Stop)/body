{
  TransitStop transitStop=getVertexForStop(stop);
  HashMap<TableTripPattern,P2<Double>> neighborhood=neighborhoods.get(stop);
  if (neighborhood == null) {
    Set<TableTripPattern> nearbyPatterns=getNearbyPatterns(stop);
    HashMap<TableTripPattern,Double> walkNeighborhood=getBestDistanceForPatterns(graph,transitStop,walkingOptions,nearbyPatterns);
    HashMap<TableTripPattern,Double> bikeNeighborhood=getBestDistanceForPatterns(graph,transitStop,bikingOptions,nearbyPatterns);
    neighborhood=new HashMap<TableTripPattern,P2<Double>>();
    for (    TableTripPattern p : nearbyPatterns) {
      Double walkDistance=walkNeighborhood.get(p);
      if (walkDistance == null) {
        continue;
      }
      Double bikeDistance=bikeNeighborhood.get(p);
      if (bikeDistance == null) {
        bikeDistance=Double.MAX_VALUE;
      }
      neighborhood.put(p,new P2<Double>(walkDistance,bikeDistance));
    }
    neighborhoods.put(stop,neighborhood);
  }
  return neighborhood;
}
