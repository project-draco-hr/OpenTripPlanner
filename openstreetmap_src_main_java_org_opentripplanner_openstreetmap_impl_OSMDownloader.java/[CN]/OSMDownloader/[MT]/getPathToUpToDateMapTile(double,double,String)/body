{
  File path=getPathToMapTile(key);
  if (needsUpdate(path)) {
    Envelope r=new Envelope(lon - _overlap,lon + _lonXStep + _overlap,lat - _overlap,lat + _latYStep + _overlap);
    _log.debug("downloading osm tile: " + key);
    URL url=constructUrl(r);
    _log.debug(url.toString());
    InputStream in=url.openStream();
    FileOutputStream out=new FileOutputStream(path);
    try {
      byte[] data=new byte[4096];
      while (true) {
        int numBytes=in.read(data);
        if (numBytes == -1) {
          break;
        }
        out.write(data,0,numBytes);
      }
      in.close();
      out.close();
    }
 catch (    RuntimeException e) {
      out.close();
      _log.info("Removing half-written file " + path);
      path.delete();
      throw e;
    }
  }
  return path;
}
