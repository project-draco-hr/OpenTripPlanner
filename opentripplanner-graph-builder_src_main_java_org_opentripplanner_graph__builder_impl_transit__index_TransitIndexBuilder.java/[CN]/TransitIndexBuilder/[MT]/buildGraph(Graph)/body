{
  _log.debug("Building transit index");
  createRouteVariants(graph);
  nameVariants(variantsByRoute);
  int totalVariants=0;
  int totalTrips=0;
  for (  List<RouteVariant> variants : variantsByRoute.values()) {
    totalVariants+=variants.size();
    for (    RouteVariant variant : variants) {
      variant.cleanup();
      totalTrips+=variant.getTrips().size();
    }
  }
  _log.debug("Built transit index: " + variantsByAgency.size() + " agencies, "+ variantsByRoute.size()+ " routes, "+ totalTrips+ " trips, "+ totalVariants+ " variants ");
  TransitIndexServiceImpl service=new TransitIndexServiceImpl(variantsByAgency,variantsByRoute,variantsByTrip,preBoardEdges,preAlightEdges,directionsByRoute,modes);
  insertCalendarData(service);
  addAgencies(service);
  graph.putService(TransitIndexService.class,service);
}
