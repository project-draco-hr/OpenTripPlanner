{
  Vertex stop_u=graph.getVertex("agency_U_depart");
  Vertex stop_v=graph.getVertex("agency_V_arrive");
  ShortestPathTree spt;
  GraphPath path;
  RoutingRequest options=new RoutingRequest();
  options.setModes(new TraverseModeSet("TRANSIT"));
  options.dateTime=TestUtils.dateInSeconds("America/New_York",2009,8,7,0,0,0);
  options.setRoutingContext(graph,stop_u,stop_v);
  spt=aStar.getShortestPathTree(options);
  path=spt.getPath(stop_v,false);
  assertNotNull(path);
  assertEquals(4,path.states.size());
  long endTime=TestUtils.dateInSeconds("America/New_York",2009,8,7,6,40,0);
  assertEquals(endTime,path.getEndTime());
  options.dateTime=TestUtils.dateInSeconds("America/New_York",2009,8,7,7,0,0);
  options.setRoutingContext(graph,stop_u,stop_v);
  spt=aStar.getShortestPathTree(options);
  path=spt.getPath(stop_v,false);
  assertNotNull(path);
  assertEquals(4,path.states.size());
  endTime=TestUtils.dateInSeconds("America/New_York",2009,8,7,7,40,0);
  assertEquals(endTime,path.getEndTime());
  options.dateTime=TestUtils.dateInSeconds("America/New_York",2009,8,7,14,0,0);
  options.setRoutingContext(graph,stop_u,stop_v);
  spt=aStar.getShortestPathTree(options);
  path=spt.getPath(stop_v,false);
  assertNotNull(path);
  assertEquals(4,path.states.size());
  endTime=TestUtils.dateInSeconds("America/New_York",2009,8,7,14,40,0);
  assertEquals(endTime,path.getEndTime());
  boolean boarded=false;
  for (  FrequencyBoard e : filter(stop_u.getOutgoing(),FrequencyBoard.class)) {
    boarded=true;
    FrequencyBoard board=(FrequencyBoard)e;
    FrequencyBasedTripPattern pattern=board.getPattern();
    int previousArrivalTime=pattern.getPreviousArrivalTime(0,0,false,false,false);
    assertTrue(previousArrivalTime < 0);
    previousArrivalTime=pattern.getPreviousArrivalTime(0,60 * 60 * 7 - 1,false,false,false);
    assertEquals(60 * 60 * 6,previousArrivalTime);
    previousArrivalTime=pattern.getPreviousArrivalTime(0,60 * 60 * 11,false,false,false);
    assertEquals(60 * 60 * 10,previousArrivalTime);
    previousArrivalTime=pattern.getPreviousArrivalTime(0,60 * 60 * 18,false,false,false);
    assertEquals(60 * 60 * 16,previousArrivalTime);
  }
  assertTrue(boarded);
}
