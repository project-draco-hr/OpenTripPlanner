{
  context=GtfsLibrary.readGtfs(new File(ConstantsForTests.FAKE_GTFS));
  graph=new Graph();
  GTFSPatternHopFactory factory=new GTFSPatternHopFactory(context);
  factory.run(graph);
  Vertex stop_a=graph.getVertex("agency_A");
  Vertex stop_b=graph.getVertex("agency_B");
  Vertex stop_c=graph.getVertex("agency_C");
  Vertex stop_d=graph.getVertex("agency_D");
  StreetVertex near_a=(StreetVertex)graph.addVertex(new StreetVertex("near_a",GeometryUtils.makeLineString(stop_a.getX() + 0.00001,stop_a.getY() + 0.00001,stop_a.getX() - 0.00001,stop_a.getY() - 0.00001),"near a",100,false));
  StreetVertex near_b=(StreetVertex)graph.addVertex(new StreetVertex("near_b",GeometryUtils.makeLineString(stop_b.getX() + 0.00001,stop_b.getY() + 0.00001,stop_b.getX() - 0.00001,stop_b.getY() - 0.00001),"near b",100,false));
  StreetVertex near_c=(StreetVertex)graph.addVertex(new StreetVertex("near_c",GeometryUtils.makeLineString(stop_c.getX() + 0.00001,stop_c.getY() + 0.00001,stop_c.getX() - 0.00001,stop_c.getY() - 0.00001),"near c",100,false));
  StreetVertex near_d=(StreetVertex)graph.addVertex(new StreetVertex("near_d",GeometryUtils.makeLineString(stop_d.getX() + 0.00001,stop_d.getY() + 0.00001,stop_d.getX() - 0.00001,stop_d.getY() - 0.00001),"near d",100,false));
  StreetVertex[] nearPoints={near_a,near_b,near_c,near_d};
  Coordinate between=new Coordinate((stop_a.getX() + stop_b.getX()) / 2,(stop_a.getY() + stop_b.getY()) / 2);
  StreetVertex nowhere=(StreetVertex)graph.addVertex(new StreetVertex("nowhere",GeometryUtils.makeLineString(between.x,between.y,between.x - 0.000001,between.y - 0.000001),"nowhere",10000,false));
  StreetVertex nowhere2=(StreetVertex)graph.addVertex(new StreetVertex("nowhere",GeometryUtils.makeLineString(between.x - 0.000001,between.y - 0.000001,between.x,between.y),"nowhere",10000,true));
  for (int i=0; i < nearPoints.length; ++i) {
    StreetVertex a=nearPoints[i];
    TurnEdge street=new TurnEdge(a,nowhere);
    graph.addEdge(a,nowhere,street);
    TurnEdge street2=new TurnEdge(nowhere2,a);
    graph.addEdge(nowhere2,a,street2);
  }
  NetworkLinker nl=new NetworkLinker(graph);
  nl.createLinkage(true);
  assertTrue(graph.getIncoming(near_b.getLabel()).size() >= 2);
}
