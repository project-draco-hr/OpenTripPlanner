{
  if (delay == 0)   return 0;
  double decay;
  if (linear) {
    decay=1 - dt * lambda * 0.5;
    if (decay < 0)     decay=0;
  }
 else {
    decay=Math.exp(-lambda * dt);
  }
  return (int)(decay * delay);
}
