{
  LOG.trace(this.dumpTimes());
  TripTimes ret=(TripTimes)this.clone();
  ret.decompact();
  for (int i=0; i < ul.updates.size(); i++) {
    int stopIndex=startIndex + i;
    Update u=ul.updates.get(i);
    if (stopIndex < ret.departureTimes.length) {
      ret.departureTimes[stopIndex]=u.depart;
    }
    if (stopIndex >= 1 && stopIndex <= ret.arrivalTimes.length) {
      ret.arrivalTimes[stopIndex - 1]=u.arrive;
    }
  }
  LOG.trace(ret.dumpTimes());
  ret.compact();
  LOG.trace(ret.dumpTimes());
  return ret;
}
