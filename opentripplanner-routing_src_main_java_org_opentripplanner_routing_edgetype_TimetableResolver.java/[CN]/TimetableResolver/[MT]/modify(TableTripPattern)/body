{
  if (dirty == null)   throw new ConcurrentModificationException("This TimetableResolver snapshot was already committed for reading.");
  Timetable existing=resolve(pattern);
  if (dirty.contains(existing)) {
    return existing;
  }
 else {
    Timetable fresh=existing.copy();
    timetables.put(pattern,fresh);
    dirty.add(fresh);
    return fresh;
  }
}
