{
  Stack<ReachState> stack=new Stack<ReachState>();
  stack.push(state);
  while (!stack.isEmpty()) {
    state=stack.peek();
    Double height=state.height;
    ReachState backState=(ReachState)state.getBackState();
    if (height != null) {
      stack.pop();
      Double maxHeight=outPenalty.get(state);
      if (maxHeight != null && maxHeight > height) {
        height=maxHeight;
      }
      state.height=height;
      if (backState != null) {
        Double backHeight=backState.height;
        if (backHeight == null || backHeight < height) {
          backState.height=height;
        }
      }
      continue;
    }
    Collection<ReachState> children=state.getChildren();
    if (children.size() == 0) {
      state.height=0.0;
    }
 else {
      for (      ReachState s : children) {
        stack.push(s);
      }
    }
  }
}
