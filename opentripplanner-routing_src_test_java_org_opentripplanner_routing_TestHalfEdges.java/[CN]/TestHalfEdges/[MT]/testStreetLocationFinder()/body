{
  StreetVertexIndexServiceImpl finder=new StreetVertexIndexServiceImpl(graph);
  finder.setup();
  Coordinate c=new Coordinate(-74.005000001,40.01);
  assertTrue(finder.getLocalTransitStops(c,100).size() > 0);
  StreetLocation some=(StreetLocation)finder.getClosestVertex(new Coordinate(-74.00,40.00),null,null);
  assertNotNull(some);
  assertTrue("wheelchair accessibility is correctly set (vertices)",some.isWheelchairAccessible());
  StreetLocation start=(StreetLocation)finder.getClosestVertex(new Coordinate(-74.01,40.004),null,null);
  assertNotNull(start);
  assertTrue("wheelchair accessibility is correctly set (splitting)",start.isWheelchairAccessible());
  List<Edge> extras=start.getExtra();
  assertEquals(10,extras.size());
  TraverseOptions biking=new TraverseOptions(new TraverseModeSet(TraverseMode.BICYCLE));
  StreetLocation end=(StreetLocation)finder.getClosestVertex(new Coordinate(-74.0,40.008),null,biking);
  assertNotNull(end);
  extras=end.getExtra();
  assertEquals(10,extras.size());
  StreetLocation location=(StreetLocation)finder.getClosestVertex(new Coordinate(-74.004999,40.00999),null,new TraverseOptions());
  assertTrue(location.isWheelchairAccessible());
  boolean found=false;
  for (  Edge extra : location.getExtra()) {
    if (extra instanceof FreeEdge && ((FreeEdge)extra).getToVertex().equals(station1)) {
      found=true;
    }
  }
  assertTrue(found);
  TraverseOptions walking=new TraverseOptions(TraverseMode.WALK);
  start=(StreetLocation)finder.getClosestVertex(new Coordinate(-74.0,40.004),null,walking);
  end=(StreetLocation)finder.getClosestVertex(new Coordinate(-74.0,40.008),null,walking,start.getExtra());
  assertNotNull(end);
  ShortestPathTree spt=AStar.getShortestPathTree(graph,start,end,0,walking);
  GraphPath path=spt.getPath(end,false);
  for (  State s : path.states) {
    assertFalse(s.getVertex() == top);
  }
}
