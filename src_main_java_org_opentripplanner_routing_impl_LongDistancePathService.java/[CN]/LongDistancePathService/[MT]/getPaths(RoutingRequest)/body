{
  if (options == null) {
    LOG.error("PathService was passed a null routing request.");
    return null;
  }
  if (options.rctx == null) {
    options.setRoutingContext(graphService.getGraph(options.routerId));
    options.rctx.pathParsers=new PathParser[]{new Parser()};
  }
  LOG.debug("rreq={}",options);
  RemainingWeightHeuristic heuristic;
  if (options.disableRemainingWeightHeuristic) {
    heuristic=new TrivialRemainingWeightHeuristic();
  }
 else   if (options.modes.isTransit()) {
    heuristic=new InterleavedBidirectionalHeuristic(options.rctx.graph);
  }
 else {
    heuristic=new DefaultRemainingWeightHeuristic();
  }
  options.rctx.remainingWeightHeuristic=heuristic;
  options.setMaxTransfers(10);
  if (options.maxWalkDistance == Double.MAX_VALUE)   options.maxWalkDistance=DEFAULT_MAX_WALK;
  if (options.maxWalkDistance > CLAMP_MAX_WALK)   options.maxWalkDistance=CLAMP_MAX_WALK;
  long searchBeginTime=System.currentTimeMillis();
  LOG.debug("BEGIN SEARCH");
  ShortestPathTree spt=sptService.getShortestPathTree(options,timeout);
  LOG.debug("END SEARCH ({} msec)",System.currentTimeMillis() - searchBeginTime);
  if (spt == null) {
    LOG.warn("SPT was null.");
    return null;
  }
  if (this.sptVisitor != null) {
    this.sptVisitor.spt=spt;
  }
  List<GraphPath> paths=spt.getPaths();
  Collections.sort(paths,new PathWeightComparator());
  return paths;
}
