{
  request.user=null;
  String username=params.get("userName");
  String password=params.get("password");
  User user=Cache.get(username,User.class);
  if (user == null) {
    Logger.debug("no user in cache");
    user=User.find("byUsername",username).first();
    if (user == null) {
      Logger.debug("no user by this username: count = %s",User.count());
      forbidden();
    }
  }
  if (user.checkPassword(password)) {
    request.user=username;
    Logger.debug("Logged in %s",user.userName);
  }
 else {
    Logger.debug("bad password");
    forbidden();
  }
}
