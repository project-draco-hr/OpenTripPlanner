{
  Graph graph=graphService.getGraph();
  transitStopTree=new STRtree();
  intersectionTree=new STRtree();
  for (  Vertex gv : graph.getVertices()) {
    Vertex v=gv;
    for (    StreetEdge e : filter(gv.getOutgoing(),StreetEdge.class)) {
      if (e.getGeometry() == null) {
        continue;
      }
      Envelope env=e.getGeometry().getEnvelopeInternal();
      edgeTree.insert(env,e);
    }
    if (v instanceof TransitStop) {
      TransitStop ts=(TransitStop)v;
      if (!ts.isEntrance() && ts.hasEntrances()) {
        continue;
      }
      Envelope env=new Envelope(v.getCoordinate());
      transitStopTree.insert(env,v);
    }
    if (v instanceof TurnVertex || v instanceof IntersectionVertex) {
      Envelope env=new Envelope(v.getCoordinate());
      intersectionTree.insert(env,v);
    }
  }
  transitStopTree.build();
}
