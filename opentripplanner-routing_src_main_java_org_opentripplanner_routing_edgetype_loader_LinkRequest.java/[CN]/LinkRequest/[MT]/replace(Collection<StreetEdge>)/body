{
  if (edges.size() == 2) {
    Iterator<StreetEdge> it=edges.iterator();
    Edge firstEdge=it.next();
    Edge secondEdge=it.next();
    if (firstEdge instanceof PlainStreetEdge && secondEdge instanceof PlainStreetEdge) {
      return new P2<PlainStreetEdge>((PlainStreetEdge)firstEdge,(PlainStreetEdge)secondEdge);
    }
  }
  P2<Entry<StreetVertex,Set<Edge>>> ends=findEndVertices(edges);
  Entry<StreetVertex,Set<Edge>> start=ends.getFirst();
  Entry<StreetVertex,Set<Edge>> end=ends.getSecond();
  StreetVertex startVertex=start.getKey();
  StreetVertex endVertex=null;
  if (end != null) {
    endVertex=end.getKey();
  }
 else {
    return null;
  }
  StreetVertex newEnd=new IntersectionVertex(linker.graph,"replace " + endVertex.getLabel(),endVertex.getX(),endVertex.getY(),endVertex.getName());
  StreetEdge forwardEdge=null;
  for (  Edge e : startVertex.getOutgoing()) {
    final Vertex toVertex=e.getToVertex();
    if (!toVertex.getCoordinate().equals(endVertex.getCoordinate())) {
      continue;
    }
    if (e instanceof StreetEdge)     forwardEdge=(StreetEdge)e;
    if (e instanceof TurnEdge) {
      final TurnEdge turnEdge=(TurnEdge)e;
      TinyTurnEdge newTurn=new TinyTurnEdge(newEnd,toVertex,turnEdge);
      addEdges(newTurn);
      newTurn.setRestrictedModes(turnEdge.getRestrictedModes());
      newTurn.setTurnCost(turnEdge.turnCost);
    }
 else {
      addEdges(new FreeEdge(newEnd,toVertex));
    }
  }
  StreetVertex newStart=new IntersectionVertex(linker.graph,"replace " + startVertex.getLabel(),startVertex.getX(),startVertex.getY(),startVertex.getName());
  StreetEdge backwardEdge=null;
  for (  Edge e : endVertex.getOutgoing()) {
    final Vertex toVertex=e.getToVertex();
    if (!toVertex.getCoordinate().equals(startVertex.getCoordinate())) {
      continue;
    }
    if (e instanceof StreetEdge)     backwardEdge=(StreetEdge)e;
    if (e instanceof TurnEdge) {
      final TurnEdge turnEdge=(TurnEdge)e;
      TinyTurnEdge newTurn=new TinyTurnEdge(newStart,toVertex,turnEdge);
      addEdges(newTurn);
      newTurn.setRestrictedModes(turnEdge.getRestrictedModes());
      newTurn.setTurnCost(turnEdge.turnCost);
    }
 else {
      addEdges(new FreeEdge(newStart,toVertex));
    }
  }
  PlainStreetEdge forward=new PlainStreetEdge(startVertex,newEnd,forwardEdge.getGeometry(),startVertex.getName(),forwardEdge.getLength(),forwardEdge.getPermission(),false);
  PlainStreetEdge backward=new PlainStreetEdge(endVertex,newStart,backwardEdge.getGeometry(),endVertex.getName(),backwardEdge.getLength(),backwardEdge.getPermission(),true);
  forward.setWheelchairAccessible(forwardEdge.isWheelchairAccessible());
  backward.setWheelchairAccessible(backwardEdge.isWheelchairAccessible());
  forward.setElevationProfile(forwardEdge.getElevationProfile(),false);
  backward.setElevationProfile(backwardEdge.getElevationProfile(),false);
  forward.setBicycleSafetyEffectiveLength(forwardEdge.getElevationProfileSegment().getBicycleSafetyEffectiveLength());
  backward.setBicycleSafetyEffectiveLength(backwardEdge.getElevationProfileSegment().getBicycleSafetyEffectiveLength());
  addEdges(forward,backward);
  P2<PlainStreetEdge> replacement=new P2<PlainStreetEdge>(forward,backward);
  return replacement;
}
