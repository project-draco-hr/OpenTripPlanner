{
  if (requestedLocale != null && resources != null) {
    if (request.getLocale() != requestedLocale) {
      resources=null;
    }
  }
  requestedLocale=request.getLocale();
  GraphPath exemplar=paths.get(0);
  Vertex tripStartVertex=exemplar.getStartVertex();
  Vertex tripEndVertex=exemplar.getEndVertex();
  String startName=localize(tripStartVertex.getName());
  String endName=localize(tripEndVertex.getName());
  if (startName == null) {
    startName=tripStartVertex.getLabel();
  }
  if (endName == null) {
    endName=tripEndVertex.getLabel();
  }
  Place from=new Place(tripStartVertex.getX(),tripStartVertex.getY(),startName);
  Place to=new Place(tripEndVertex.getX(),tripEndVertex.getY(),endName);
  TripPlan plan=new TripPlan(from,to,request.getDateTime());
  for (  GraphPath path : paths) {
    Itinerary itinerary=generateItinerary(path,request.isShowIntermediateStops());
    itinerary=adjustItinerary(request,itinerary);
    plan.addItinerary(itinerary);
  }
  return plan;
}
