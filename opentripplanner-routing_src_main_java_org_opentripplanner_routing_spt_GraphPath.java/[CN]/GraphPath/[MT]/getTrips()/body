{
  List<AgencyAndId> ret=new LinkedList<AgencyAndId>();
  for (  State s : states) {
    Edge e=s.getBackEdge();
    Trip trip=null;
    if (e instanceof PatternBoard) {
      trip=((PatternBoard)e).getPattern().getTrip(s.getTrip());
    }
 else     if (e instanceof Board) {
      trip=((Board)e).getTrip();
    }
 else {
      continue;
    }
    ret.add(trip.getId());
  }
  return ret;
}
