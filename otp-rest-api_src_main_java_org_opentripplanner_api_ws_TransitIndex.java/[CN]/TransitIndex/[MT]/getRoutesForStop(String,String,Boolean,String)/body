{
  TransitIndexService transitIndexService=getGraph(routerId).getService(TransitIndexService.class);
  if (transitIndexService == null) {
    return new TransitError("No transit index found.  Add TransitIndexBuilder to your graph builder configuration and rebuild your graph.");
  }
  RouteList result=new RouteList();
  for (  String string : getAgenciesIds(agency,routerId)) {
    List<AgencyAndId> routes=transitIndexService.getRoutesForStop(new AgencyAndId(string,id));
    result.routes.addAll(makeRouteList(routes,null,extended,routerId).routes);
  }
  return result;
}
