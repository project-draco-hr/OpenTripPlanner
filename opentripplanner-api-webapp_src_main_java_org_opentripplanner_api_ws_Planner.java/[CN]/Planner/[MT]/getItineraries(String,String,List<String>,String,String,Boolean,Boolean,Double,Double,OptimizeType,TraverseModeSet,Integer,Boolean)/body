{
  Request request=new Request();
  request.setFrom(fromPlace);
  request.setTo(toPlace);
  request.setDateTime(date,time);
  request.setWheelchair(wheelchair);
  if (max != null) {
    request.setNumItineraries(max);
  }
  if (maxWalkDistance != null) {
    request.setWalk(maxWalkDistance);
  }
  if (arriveBy != null && arriveBy) {
    request.setArriveBy(true);
  }
  if (showIntermediateStops != null && showIntermediateStops) {
    request.setShowIntermediateStops(true);
  }
  if (intermediatePlaces != null && !intermediatePlaces.get(0).equals("")) {
    request.setIntermediatePlaces(intermediatePlaces);
  }
  request.setOptimize(optimize);
  request.setModes(modes);
  Response response=new Response(request);
  try {
    TripPlan plan=generatePlan(request);
    response.setPlan(plan);
  }
 catch (  VertexNotFoundException e) {
    PlannerError error=new PlannerError(Message.OUTSIDE_BOUNDS);
    error.setMissing(e.getMissing());
    response.setError(error);
  }
catch (  PathNotFoundException e) {
    PlannerError error=new PlannerError(Message.PATH_NOT_FOUND);
    response.setError(error);
  }
catch (  LocationNotAccessible e) {
    PlannerError error=new PlannerError(Message.LOCATION_NOT_ACCESSIBLE);
    response.setError(error);
  }
catch (  Exception e) {
    LOGGER.log(Level.SEVERE,"exception planning trip: ",e);
    PlannerError error=new PlannerError(Message.SYSTEM_ERROR);
    response.setError(error);
  }
  return response;
}
