{
  Response response=new Response(httpServletRequest);
  TraverseOptions request;
  try {
    request=buildRequest();
  }
 catch (  ParameterException pe) {
    PlannerError error=new PlannerError(pe.message);
    response.setError(error);
    return response;
  }
  try {
    TripPlan plan=planGenerator.generate(request);
    response.setPlan(plan);
  }
 catch (  VertexNotFoundException e) {
    PlannerError error=new PlannerError(Message.OUTSIDE_BOUNDS);
    error.setMissing(e.getMissing());
    response.setError(error);
  }
catch (  PathNotFoundException e) {
    PlannerError error=new PlannerError(Message.PATH_NOT_FOUND);
    response.setError(error);
  }
catch (  LocationNotAccessible e) {
    PlannerError error=new PlannerError(Message.LOCATION_NOT_ACCESSIBLE);
    response.setError(error);
  }
catch (  TransitTimesException e) {
    PlannerError error=new PlannerError(Message.NO_TRANSIT_TIMES);
    response.setError(error);
  }
catch (  TrivialPathException e) {
    PlannerError error=new PlannerError(Message.TOO_CLOSE);
    response.setError(error);
  }
catch (  Exception e) {
    LOG.error("exception planning trip: ",e);
    PlannerError error=new PlannerError(Message.SYSTEM_ERROR);
    response.setError(error);
  }
 finally {
    if (request.rctx != null) {
      int nRemoved=request.rctx.destroy();
      LOG.debug("routing context destroyed ({} temporary edges removed)",nRemoved);
    }
  }
  return response;
}
