{
  if (graph != null)   throw new IllegalStateException("Graph must be set before preparing for search.");
  findEndpointVertices();
  setCalendarService(graph.getService(CalendarService.class));
  setTransferTable(graph.getTransferTable());
  setServiceDays(dateTime.getTime() / 1000,graph.getAgencyIds());
  if (getModes().isTransit() && !graph.transitFeedCovers(dateTime)) {
    throw new TransitTimesException();
  }
  remainingWeightHeuristic=_remainingWeightHeuristicFactory.getInstanceForSearch(this);
  LOG.debug("Applied A* heuristic: {}",remainingWeightHeuristic);
  if (!getModes().isTransit()) {
    numItineraries=1;
    setMaxWalkDistance(Double.MAX_VALUE);
  }
  setServiceDays(dateTime.getTime() / 1000,graph.getAgencyIds());
  this.initialized=true;
}
