{
  if (graph == null)   throw new IllegalStateException("Graph must be set before preparing for search.");
  findEndpointVertices();
  setCalendarService(graph.getService(CalendarService.class));
  setTransferTable(graph.getTransferTable());
  setServiceDays();
  if (getModes().isTransit() && !graph.transitFeedCovers(dateTime)) {
    throw new TransitTimesException();
  }
  if (!getModes().isTransit()) {
    numItineraries=1;
    setMaxWalkDistance(Double.MAX_VALUE);
  }
  this.initialized=true;
}
