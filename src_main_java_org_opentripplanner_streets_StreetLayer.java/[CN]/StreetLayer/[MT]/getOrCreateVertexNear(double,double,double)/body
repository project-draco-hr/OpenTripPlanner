{
  Split split=findSplit(lat,lon,radiusMeters);
  if (split == null) {
    return -1;
  }
  EdgeStore.Edge edge=edgeStore.getCursor(split.edge);
  if (split.distance0_mm < SNAP_RADIUS_MM || split.distance1_mm < SNAP_RADIUS_MM) {
    if (split.distance0_mm < split.distance1_mm) {
      return edge.getFromVertex();
    }
 else {
      return edge.getToVertex();
    }
  }
  int newVertexIndex=vertexStore.addVertexFixed((int)split.fLat,(int)split.fLon);
  int oldToVertex=edge.getToVertex();
  edge.setLengthMm(split.distance0_mm);
  edge.setToVertex(newVertexIndex);
  edge.setGeometry(Collections.EMPTY_LIST);
  EdgeStore.Edge newEdge=edgeStore.addStreetPair(newVertexIndex,oldToVertex,split.distance1_mm);
  spatialIndex.insert(newEdge.getEnvelope(),newEdge.edgeIndex);
  return newVertexIndex;
}
