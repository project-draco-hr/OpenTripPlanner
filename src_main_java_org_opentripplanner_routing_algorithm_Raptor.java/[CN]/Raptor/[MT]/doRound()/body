{
  Set<TripPattern> oldMarkedPatterns=markedPatterns;
  markedPatterns=Sets.newHashSet();
  LOG.info("Exploring {} patterns",oldMarkedPatterns.size());
  PATTERNS:   for (  TripPattern tp : oldMarkedPatterns) {
    STOPS:     for (int i=0; i < tp.stopVertices.length; i++) {
      State s=store.getPrev(tp.stopVertices[i]);
      if (s == null)       continue STOPS;
      propagate(s,tp,i);
    }
  }
  store.proceed();
  findTransfers();
  return !markedPatterns.isEmpty();
}
