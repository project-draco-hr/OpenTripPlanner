{
  Vertex v=state.getVertex();
  if (v instanceof StreetVertex || v instanceof StreetLocation) {
    TraverseModeSet modes=state.getOptions().getModes();
    if (modes.contains(TraverseMode.BICYCLE) && (!modes.contains(TraverseMode.WALK) || !state.isBikeRenting())) {
      Edge edge=state.getBackEdge();
      if (edge instanceof StreetEdge) {
        int cls=((StreetEdge)edge).getStreetClass();
        return cls & StreetEdge.CROSSING_CLASS_MASK;
      }
 else {
        return StreetEdge.CLASS_OTHERPATH;
      }
    }
 else {
      return StreetEdge.CLASS_OTHERPATH;
    }
  }
  if (v instanceof OnboardVertex)   return TRANSIT;
  if (v instanceof OffboardVertex)   return STATION;
  if (v instanceof BikeRentalStationVertex || v instanceof ParkAndRideVertex)   return StreetEdge.CLASS_OTHERPATH;
 else   throw new RuntimeException("failed to tokenize path");
}
