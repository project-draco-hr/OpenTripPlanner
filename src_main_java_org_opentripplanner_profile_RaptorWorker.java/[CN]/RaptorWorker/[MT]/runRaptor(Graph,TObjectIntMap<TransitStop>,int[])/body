{
  long beginCalcTime=System.currentTimeMillis();
  long totalPropagationTime=0;
  TIntIntMap initialStops=new TIntIntHashMap();
  TObjectIntIterator<TransitStop> initialIterator=accessTimes.iterator();
  while (initialIterator.hasNext()) {
    initialIterator.advance();
    TransitStop tstop=initialIterator.key();
    int accessTime=initialIterator.value();
    int stopIndex=data.indexForStop.get(tstop.getStop());
    if (stopIndex == -1) {
      continue;
    }
    initialStops.put(stopIndex,accessTime);
  }
  PropagatedTimesStore propagatedTimesStore=new PropagatedTimesStore(graph);
  int iterations=(req.toTime - req.fromTime - 60) / 60 + 1;
  int[][] timesAtTargetsEachMinute=new int[iterations][walkTimes.length];
  for (int departureTime=req.toTime - 60, n=0; departureTime >= req.fromTime; departureTime-=60, n++) {
    if (n % 15 == 0) {
      LOG.info("minute {}",n);
    }
    this.runRaptor(initialStops,departureTime);
    long beginPropagationTime=System.currentTimeMillis();
    int[] timesAtTargets=timesAtTargetsEachMinute[n];
    System.arraycopy(walkTimes,0,timesAtTargets,0,walkTimes.length);
    for (int i=0; i < timesAtTargets.length; i++) {
      timesAtTargets[i]=walkTimes[i];
    }
    for (int s=0; s < data.nStops; s++) {
      int baseTimeSeconds=bestTimes[s];
      if (baseTimeSeconds != UNREACHED) {
        baseTimeSeconds-=departureTime;
        int[] targets=data.targetsForStop.get(s);
        for (int i=0; i < targets.length; i++) {
          int targetIndex=targets[i++];
          int distance=targets[i];
          int egressWalkTimeSeconds=(int)(distance / req.walkSpeed);
          int propagated_time=baseTimeSeconds + egressWalkTimeSeconds;
          if (timesAtTargets[targetIndex] > propagated_time) {
            timesAtTargets[targetIndex]=propagated_time;
          }
        }
      }
    }
    totalPropagationTime+=(System.currentTimeMillis() - beginPropagationTime);
  }
  long calcTime=System.currentTimeMillis() - beginCalcTime;
  LOG.info("calc time {}sec",calcTime / 1000.0);
  LOG.info("  propagation {}sec",totalPropagationTime / 1000.0);
  LOG.info("  raptor {}sec",(calcTime - totalPropagationTime) / 1000.0);
  propagatedTimesStore.setFromArray(timesAtTargetsEachMinute);
  return propagatedTimesStore;
}
