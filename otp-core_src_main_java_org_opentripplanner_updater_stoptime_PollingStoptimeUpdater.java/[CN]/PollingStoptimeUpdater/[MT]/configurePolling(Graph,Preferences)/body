{
  String sourceType=preferences.get("sourceType",null);
  if (sourceType != null) {
    if (sourceType.equals("gtfs-http")) {
      updateSource=new GtfsRealtimeHttpTripUpdateSource();
    }
 else     if (sourceType.equals("gtfs-zmq")) {
      updateSource=new GtfsRealtimeZmqTripUpdateSource();
    }
 else     if (sourceType.equals("kv8-zmq")) {
      updateSource=new Kv8ZmqTripUpdateSource();
    }
  }
  if (updateSource == null) {
    throw new IllegalArgumentException("Unknown update streamer source type: " + sourceType);
  }
 else   if (updateSource instanceof PreferencesConfigurable) {
    ((PreferencesConfigurable)updateSource).configure(graph,preferences);
  }
  int logFrequency=preferences.getInt("logFrequency",-1);
  if (logFrequency >= 0)   this.logFrequency=logFrequency;
  int maxSnapshotFrequency=preferences.getInt("maxSnapshotFrequencyMs",-1);
  if (maxSnapshotFrequency >= 0)   this.maxSnapshotFrequency=maxSnapshotFrequency;
  String purgeExpiredData=preferences.get("purgeExpiredData","");
  if (!purgeExpiredData.isEmpty()) {
    this.purgeExpiredData=preferences.getBoolean("purgeExpiredData",true);
  }
  LOG.info("Creating stop time updater running every {} seconds : {}",getFrequencySec(),updateSource);
}
