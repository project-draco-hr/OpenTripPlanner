{
  if (endTime == null) {
    endTime=startTime + 86400;
  }
  if (endTime - startTime > MAX_STOP_TIME_QUERY_INTERVAL) {
    return new TransitError("Max stop time query interval is " + (endTime - startTime));
  }
  TransitIndexService transitIndexService=graphService.getGraph().getService(TransitIndexService.class);
  if (transitIndexService == null) {
    return new TransitError("No transit index found.  Add TransitIndexBuilder to your graph builder configuration and rebuild your graph.");
  }
  AgencyAndId stop=new AgencyAndId(stopAgency,stopId);
  Edge preBoardEdge=transitIndexService.getPreBoardEdge(stop);
  Vertex boarding=preBoardEdge.getToVertex();
  TraverseOptions options=makeTraverseOptions(startTime);
  HashSet<AgencyAndId> trips=new HashSet<AgencyAndId>();
  StopTimeList result=new StopTimeList();
  result.stopTimes=new ArrayList<StopTime>();
  for (  Edge e : boarding.getOutgoing()) {
    for (    StopTime st : getStopTimesForBoardEdge(startTime,endTime,options,e)) {
      result.stopTimes.add(st);
      trips.add(st.trip);
    }
  }
  Edge preAlightEdge=transitIndexService.getPreAlightEdge(stop);
  Vertex alighting=preAlightEdge.getFromVertex();
  for (  Edge e : alighting.getIncoming()) {
    for (    StopTime st : getStopTimesForAlightEdge(startTime,endTime,options,e)) {
      if (!trips.contains(st.trip)) {
        result.stopTimes.add(st);
      }
    }
  }
  return result;
}
