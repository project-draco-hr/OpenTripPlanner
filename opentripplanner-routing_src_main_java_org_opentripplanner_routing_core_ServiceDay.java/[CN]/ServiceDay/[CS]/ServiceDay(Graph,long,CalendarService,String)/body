{
  TimeZone timeZone=cs.getTimeZoneForAgencyId(agencyId);
  GregorianCalendar calendar=new GregorianCalendar(timeZone);
  calendar.setTime(new Date(time * 1000));
  ServiceDate sd=new ServiceDate(calendar);
  Date d=sd.getAsDate(timeZone);
  this.midnight=d.getTime() / 1000;
  serviceIdsRunning=new int[cs.getServiceIds().size() / 32 + 1];
  ServiceIdToNumberService service=graph.getService(ServiceIdToNumberService.class);
  for (  AgencyAndId serviceId : cs.getServiceIdsOnDate(sd)) {
    int n=service.getNumber(serviceId);
    if (n < 0)     continue;
    serviceIdsRunning[n / 32]|=(1 << (n % 32));
  }
}
