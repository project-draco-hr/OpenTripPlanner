{
  GtfsRelationalDao dao=getGtfsContext().getDao();
  for (  StopTime stopTime : dao.getAllStopTimes()) {
    Stop stop=stopTime.getStop();
    Trip trip=stopTime.getTrip();
    String shapeId=trip.getShapeId().toString();
    if (shapeId == null) {
      System.out.println("shape id is null, continuing");
      continue;
    }
    Route route=trip.getRoute();
    String routeId=route.getId().toString();
    String tripId=trip.getId().toString();
    String stopId=stop.getId().toString();
    String latLon=stop.getLat() + "," + stop.getLon();
    if (!latLonToStopIds.containsKey(latLon)) {
      latLonToStopIds.put(latLon,new HashSet<String>());
    }
    Set<String> stopIdsForLatLon=latLonToStopIds.get(latLon);
    stopIdsForLatLon.add(stopId);
    if (!stopIdsToStopTimes.containsKey(stopId)) {
      stopIdsToStopTimes.put(stopId,new ArrayList<StopTime>());
    }
    List<StopTime> stopTimesForStopId=stopIdsToStopTimes.get(stopId);
    stopTimesForStopId.add(stopTime);
    if (!stopIdsToStops.containsKey(stopId)) {
      stopIdsToStops.put(stopId,stop);
    }
    if (!representativeTripIds.contains(tripId)) {
      continue;
    }
    routeIdsToShapePointIds.put(routeId,shapeId);
    if (!routeIdsToStops.containsKey(routeId)) {
      routeIdsToStops.put(routeId,new ArrayList<Stop>());
    }
    List<Stop> stopsForRoute=routeIdsToStops.get(routeId);
    stopsForRoute.add(stop);
    routeIdsToRoutes.put(routeId,route);
    Set<String> routeIdsForStopId=stopIdsToRouteIds.get(stopId);
    if (routeIdsForStopId == null) {
      routeIdsForStopId=new HashSet<String>();
      stopIdsToRouteIds.put(stopId,routeIdsForStopId);
    }
    routeIdsForStopId.add(routeId);
  }
  for (  ShapePoint sp : dao.getAllShapePoints()) {
    String shapeId=sp.getShapeId().toString();
    if (!shapeIdsToShapePoints.containsKey(shapeId)) {
      shapeIdsToShapePoints.put(shapeId,new ArrayList<ShapePoint>());
    }
    List<ShapePoint> shapePoints=shapeIdsToShapePoints.get(shapeId);
    shapePoints.add(sp);
  }
}
