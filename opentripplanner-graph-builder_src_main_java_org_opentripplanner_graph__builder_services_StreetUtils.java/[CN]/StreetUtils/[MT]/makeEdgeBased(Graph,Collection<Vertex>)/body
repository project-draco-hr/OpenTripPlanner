{
  _log.debug("converting to edge-based graph");
  ArrayList<DirectEdge> turns=new ArrayList<DirectEdge>(endpoints.size());
  for (  Vertex v : endpoints) {
    for (    Edge e : graph.getIncoming(v)) {
      PlainStreetEdge pse=(PlainStreetEdge)e;
      boolean replaced=false;
      StreetVertex v1=getStreetVertexForEdge(graph,pse);
      for (      Edge e2 : graph.getOutgoing(v)) {
        StreetVertex v2=getStreetVertexForEdge(graph,(PlainStreetEdge)e2);
        if (v1 != v2 && !v1.getEdgeId().equals(v2.getEdgeId())) {
          turns.add(new TurnEdge(v1,v2));
          replaced=true;
        }
      }
      if (!replaced) {
        pse.setFromVertex(v1);
        turns.add(pse);
      }
    }
  }
  for (  Vertex v : endpoints) {
    graph.removeVertexAndEdges(v);
  }
  for (  DirectEdge e : turns) {
    graph.addEdge(e);
  }
}
