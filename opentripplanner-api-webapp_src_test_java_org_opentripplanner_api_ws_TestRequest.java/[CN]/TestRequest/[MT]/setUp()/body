{
  DataHolder holder=DataHolder.getInstance();
  graph=holder.graph;
  planner=holder.planner;
  pathService=holder.pathService;
  if (graph != null) {
    return;
  }
  planner=new Planner();
  pathService=new ContractionPathServiceImpl();
  graph=new Graph();
  ShapefileStreetGraphBuilderImpl builder=new ShapefileStreetGraphBuilderImpl();
  FeatureSourceFactory factory=new ShapefileFeatureSourceFactoryImpl(new File("src/test/resources/portland/Streets_pdx.shp"));
  builder.setFeatureSourceFactory(factory);
  ShapefileStreetSchema schema=new ShapefileStreetSchema();
  schema.setIdAttribute("LOCALID");
  schema.setNameAttribute("FULL_NAME");
  CaseBasedTraversalPermissionConverter perms=new CaseBasedTraversalPermissionConverter("DIRECTION",StreetTraversalPermission.PEDESTRIAN_AND_BICYCLE);
  perms.addPermission("2",StreetTraversalPermission.ALL,StreetTraversalPermission.PEDESTRIAN);
  perms.addPermission("3",StreetTraversalPermission.PEDESTRIAN,StreetTraversalPermission.ALL);
  perms.addPermission("1",StreetTraversalPermission.ALL,StreetTraversalPermission.ALL);
  schema.setPermissionConverter(perms);
  builder.setSchema(schema);
  builder.buildGraph(graph);
  ContractionHierarchySet hierarchies=new ContractionHierarchySet(graph,null);
  GraphServiceImpl graphService=new GraphServiceImpl();
  graphService.setContractionHierarchySet(hierarchies);
  pathService.setGraphService(graphService);
  ContractionRoutingServiceImpl routingService=new ContractionRoutingServiceImpl();
  routingService.setGraphService(graphService);
  pathService.setRoutingService(routingService);
  planner.setPathService(pathService);
  holder.graph=graph;
  holder.planner=planner;
  holder.pathService=pathService;
}
