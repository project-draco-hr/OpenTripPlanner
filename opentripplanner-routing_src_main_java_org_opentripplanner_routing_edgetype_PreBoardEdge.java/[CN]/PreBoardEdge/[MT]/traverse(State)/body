{
  RoutingRequest options=s0.getOptions();
  if (options.isArriveBy()) {
    StateEditor s1=s0.edit(this);
    TransitStop fromVertex=(TransitStop)getFromVertex();
    if (fromVertex.isLocal()) {
      s1.setAlightedLocal(true);
    }
    s1.incrementTimeInSeconds(options.getBoardSlack());
    s1.alightTransit();
    s1.setBackMode(getMode());
    return s1.makeState();
  }
 else {
    if (!options.getModes().isTransit())     return null;
    TransitStop fromVertex=(TransitStop)getFromVertex();
    if (fromVertex.isLocal() && s0.isEverBoarded()) {
      return null;
    }
    if (s0.getNumBoardings() > options.maxTransfers)     return null;
    long t0=s0.getTimeSeconds();
    long slack;
    if (s0.isEverBoarded()) {
      slack=options.getTransferSlack() - options.getAlightSlack();
    }
 else {
      slack=options.getBoardSlack();
    }
    long board_after=t0 + slack;
    long transfer_penalty=0;
    if (s0.getLastAlightedTimeSeconds() != 0) {
      TransferTable transferTable=s0.getContext().transferTable;
      if (transferTable.hasPreferredTransfers()) {
        transfer_penalty=options.nonpreferredTransferPenalty;
      }
      int transfer_time=transferTable.getTransferTime(s0.getPreviousStop(),getToVertex());
      if (transfer_time == TransferTable.UNKNOWN_TRANSFER) {
      }
 else       if (transfer_time >= 0) {
        long table_board_after=s0.getLastAlightedTimeSeconds() + transfer_time;
        if (table_board_after > board_after)         board_after=table_board_after;
      }
 else       if (transfer_time == TransferTable.FORBIDDEN_TRANSFER) {
        return null;
      }
 else       if (transfer_time == TransferTable.PREFERRED_TRANSFER) {
        transfer_penalty=0;
      }
 else {
        throw new IllegalStateException("Undefined value in transfer table.");
      }
      if (transfer_time == 0) {
        transfer_penalty=0;
      }
    }
 else {
    }
    if (s0.isEverBoarded()) {
      transfer_penalty+=options.transferPenalty;
    }
    StateEditor s1=s0.edit(this);
    s1.setTimeSeconds(board_after);
    s1.setEverBoarded(true);
    long wait_cost=board_after - t0;
    s1.incrementWeight(wait_cost + transfer_penalty);
    s1.setBackMode(getMode());
    return s1.makeState();
  }
}
