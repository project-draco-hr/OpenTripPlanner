{
  Edge e=state.getBackEdge();
  if (e == null) {
    throw new RuntimeException("terminalFor should never be called on States without back edges!");
  }
  if (e instanceof OnboardEdge)   return ONBOARD;
  if (e instanceof StationEdge)   return STATION;
  if (e instanceof StationStopEdge) {
    int to_type=((TransitStop)state.getVertex()).getStop().getLocationType();
    return to_type == 1 ? STOP_STATION : STATION_STOP;
  }
  if (e instanceof SimpleTransfer)   return TRANSFER;
  if (e instanceof TransferEdge)   return TRANSFER;
  if (e instanceof TimedTransferEdge)   return TRANSFER;
  if (e instanceof StreetTransitLink)   return LINK;
  return STREET;
}
