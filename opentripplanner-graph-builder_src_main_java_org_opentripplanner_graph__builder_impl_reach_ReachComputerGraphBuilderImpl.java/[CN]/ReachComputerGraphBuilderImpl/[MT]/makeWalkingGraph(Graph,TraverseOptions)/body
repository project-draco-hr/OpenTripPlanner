{
  OverlayGraph newGraph=new OverlayGraph(graph);
  for (  Vertex vertex : graph.getVertices()) {
    options.setArriveBy(false);
    for (    Edge e : vertex.getOutgoing()) {
      if (e instanceof StreetEdge || e instanceof StreetTransitLink) {
        if (e.traverse(new State(vertex,options)) != null) {
          newGraph.addOutgoing(vertex,e);
        }
      }
    }
    options.setArriveBy(true);
    for (    Edge e : vertex.getIncoming()) {
      if (e instanceof StreetEdge || e instanceof StreetTransitLink) {
        if (e.traverse(new State(vertex,options)) != null) {
          newGraph.addIncoming(vertex,e);
        }
      }
    }
  }
  return newGraph;
}
