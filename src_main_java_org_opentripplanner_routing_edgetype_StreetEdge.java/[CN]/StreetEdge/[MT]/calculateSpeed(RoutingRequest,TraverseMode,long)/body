{
  if (traverseMode == null) {
    return Double.NaN;
  }
 else   if (traverseMode.isDriving()) {
    StreetSpeedSource source=options.getRoutingContext().graph.streetSpeedSource;
    if (source != null) {
      double congestedSpeed=source.getSpeed(this,traverseMode,timeMillis);
      if (!Double.isNaN(congestedSpeed))       return congestedSpeed;
    }
    return calculateCarSpeed(options);
  }
  return options.getSpeed(traverseMode);
}
