{
  if (routerId == null || routerId.isEmpty()) {
    routerId=defaultRouterId;
    LOG.debug("routerId not specified, set to default of '{}'",routerId);
  }
  Graph graph;
  File graphFile=getFileForRouterId(routerId);
  graph=graphs.get(graphFile.getAbsolutePath());
  Long modTime=modTimes.get(graphFile.getAbsolutePath());
  LOG.debug("graph for routerId '{}' is at {}",routerId,graphFile.getAbsolutePath());
  if (graphFile == null || !graphFile.exists()) {
    LOG.warn("graph file not found: {}",graphFile);
    if (routerId.equals(defaultRouterId))     throw new RuntimeException("graph for default routerId does not exist: " + graphFile);
    return getGraph(null);
  }
  if (modTime == null || graphFile.lastModified() > modTime) {
    LOG.debug("this graph has changed or was not yet loaded");
    modTime=graphFile.lastModified();
    try {
      graph=Graph.load(graphFile,loadLevel);
      modTimes.put(graphFile.getAbsolutePath(),modTime);
      graphs.put(graphFile.getAbsolutePath(),graph);
    }
 catch (    Exception ex) {
      LOG.error("Exception while loading graph from {}.",graphFile);
      throw new RuntimeException("error loading graph from " + graphFile,ex);
    }
  }
 else {
    LOG.debug("returning cached graph {} for routerId '{}'",graph,routerId);
  }
  return graph;
}
