{
  File gtfs=new File("src/test/resources/" + getFeedName());
  File gtfsRealTime=new File("src/test/resources/" + getFeedName() + ".pb");
  GtfsBundle gtfsBundle=new GtfsBundle(gtfs);
  List<GtfsBundle> gtfsBundleList=Collections.singletonList(gtfsBundle);
  GtfsGraphBuilderImpl gtfsGraphBuilderImpl=new GtfsGraphBuilderImpl(gtfsBundleList);
  alertsUpdateHandler=new AlertsUpdateHandler();
  graph=new Graph();
  gtfsBundle.setTransfersTxtDefinesStationPaths(true);
  gtfsGraphBuilderImpl.buildGraph(graph,null);
  agencyId=graph.getAgencyIds().iterator().next();
  System.out.printf("Set the agency ID for this test to %s\n",agencyId);
  graph.index(new DefaultStreetVertexIndexFactory());
  timetableSnapshotSource=new TimetableSnapshotSource(graph);
  timetableSnapshotSource.purgeExpiredData=(false);
  graph.timetableSnapshotSource=(timetableSnapshotSource);
  alertPatchServiceImpl=new AlertPatchServiceImpl(graph);
  alertsUpdateHandler.setAlertPatchService(alertPatchServiceImpl);
  alertsUpdateHandler.setDefaultAgencyId("MMRI");
  try {
    InputStream inputStream=new FileInputStream(gtfsRealTime);
    FeedMessage feedMessage=FeedMessage.PARSER.parseFrom(inputStream);
    List<FeedEntity> feedEntityList=feedMessage.getEntityList();
    List<TripUpdate> updates=new ArrayList<TripUpdate>(feedEntityList.size());
    for (    FeedEntity feedEntity : feedEntityList) {
      updates.add(feedEntity.getTripUpdate());
    }
    timetableSnapshotSource.applyTripUpdates(updates,agencyId);
    alertsUpdateHandler.update(feedMessage);
  }
 catch (  Exception exception) {
  }
  genericAStar=new GenericAStarFactory();
  if (isLongDistance()) {
    pathService=new GraphPathFinder(null,genericAStar);
  }
 else {
    pathService=null;
  }
  planGenerator=new PlanGenerator(null,pathService);
}
