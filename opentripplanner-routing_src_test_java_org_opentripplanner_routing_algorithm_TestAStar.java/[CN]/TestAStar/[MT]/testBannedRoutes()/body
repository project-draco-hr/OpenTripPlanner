{
  Graph graph=ConstantsForTests.getInstance().getPortlandGraph();
  TraverseOptions options=new TraverseOptions();
  Vertex start=graph.getVertex("TriMet_8371");
  Vertex end=graph.getVertex("TriMet_8374");
  options.dateTime=TestUtils.dateInSeconds("America/Los_Angeles",2009,11,1,12,34,25);
  options.setRoutingContext(graph,start,end);
  ShortestPathTree spt=null;
  String[] maxLines={"MAX Red Line","MAX Blue Line","MAX Green Line"};
  for (int i=0; i < maxLines.length; ++i) {
    String line=maxLines[i];
    options.bannedRoutes.add(new RouteSpec("TriMet",line));
    spt=aStar.getShortestPathTree(options);
    GraphPath path=spt.getPath(end,true);
    for (    State s : path.states) {
      if (s.getBackEdge() instanceof PatternHop) {
        PatternHop e=(PatternHop)s.getBackEdge();
        assertFalse(e.getName().equals(line));
        boolean foundMaxLine=false;
        for (int j=0; j < maxLines.length; ++j) {
          if (j != i) {
            if (e.getName().equals(maxLines[j])) {
              foundMaxLine=true;
            }
          }
        }
        assertTrue(foundMaxLine);
      }
    }
    options.bannedRoutes.clear();
  }
}
