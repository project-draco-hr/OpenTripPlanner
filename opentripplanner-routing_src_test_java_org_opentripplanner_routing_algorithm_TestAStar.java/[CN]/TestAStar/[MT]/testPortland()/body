{
  Graph graph;
  GtfsContext context;
  graph=ConstantsForTests.getInstance().getPortlandGraph();
  context=ConstantsForTests.getInstance().getPortlandContext();
  Vertex start=graph.getVertex("TriMet_8371");
  TraverseOptions wo=new TraverseOptions();
  wo.setGtfsContext(context);
  GregorianCalendar startTime=new GregorianCalendar(2009,11,1,12,34,25);
  ShortestPathTree spt=null;
  Vertex end=graph.getVertex("TriMet_8374");
  String[] maxLines={"MAX Red Line","MAX Blue Line","MAX Green Line"};
  for (int i=0; i < maxLines.length; ++i) {
    String line=maxLines[i];
    wo.bannedRoutes.add(new RouteSpec("TriMet",line));
    spt=AStar.getShortestPathTree(graph,start,end,new State(startTime.getTimeInMillis()),wo);
    GraphPath path=spt.getPath(end);
    for (    SPTEdge e : path.edges) {
      if (e.payload instanceof PatternBoard) {
        assertFalse(e.getName().equals(line));
        boolean foundMaxLine=false;
        for (int j=0; j < maxLines.length; ++j) {
          if (j != i) {
            if (e.getName().equals(maxLines[j])) {
              foundMaxLine=true;
            }
          }
        }
        assertTrue(foundMaxLine);
      }
    }
    wo.bannedRoutes.clear();
  }
  Vertex airport=graph.getVertex("TriMet_10579");
  long startClock, endClock;
  final int n_trials=100;
  String random[]=new String[n_trials];
  for (int i=0; i < n_trials; ++i) {
    String label;
    while (true) {
      int rand_id=(int)(Math.random() * 10000);
      label="TriMet_" + rand_id;
      if (graph.getVertex(label) != null) {
        break;
      }
    }
    random[i]=label;
  }
  startClock=System.nanoTime();
  for (int i=0; i < n_trials; ++i) {
    spt=AStar.getShortestPathTree(graph,random[i],airport.getLabel(),new State(startTime.getTimeInMillis()),wo);
  }
  endClock=System.nanoTime();
  long aStarTime=endClock - startClock;
  GraphPath path=spt.getPath(airport);
  assertNotNull(path);
  double time=aStarTime / n_trials / 1000000000.0;
  assertTrue("Actual time " + time + "s greater than 500 ms",time <= 0.5);
}
