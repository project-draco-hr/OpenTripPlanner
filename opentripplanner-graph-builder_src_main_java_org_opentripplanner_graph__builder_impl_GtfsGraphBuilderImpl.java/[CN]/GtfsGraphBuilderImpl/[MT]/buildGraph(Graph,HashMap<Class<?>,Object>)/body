{
  try {
    readGtfs(graph);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  CalendarServiceDataFactoryImpl factory=new CalendarServiceDataFactoryImpl();
  factory.setGtfsDao(_dao);
  CalendarServiceData data=factory.createData();
  CalendarServiceImpl service=new CalendarServiceImpl();
  service.setData(data);
  GtfsContext context=GtfsLibrary.createContext(_dao,service);
  GTFSPatternHopFactory hf=new GTFSPatternHopFactory(context);
  hf.setFareServiceFactory(_fareServiceFactory);
  hf.run(graph);
  graph.putService(CalendarServiceData.class,data);
  graph.updateTransitFeedValidity(data);
  if (gtfsGraphBuilders != null) {
    for (    GraphBuilderWithGtfsDao builder : gtfsGraphBuilders) {
      builder.setDao(_dao);
      builder.buildGraph(graph);
      builder.setDao(null);
    }
  }
  if (_dao instanceof GtfsRelationalDaoImpl)   _dao=new GtfsRelationalDaoImpl();
}
