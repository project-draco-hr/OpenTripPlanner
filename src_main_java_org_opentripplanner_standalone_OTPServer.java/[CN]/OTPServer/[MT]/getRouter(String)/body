{
  Graph graph=graphService.getGraph(routerId);
synchronized (routers) {
    if (graph == null) {
      routers.remove(routerId);
      return null;
    }
    Router router=routers.get(routerId);
    if (router == null || router.graph != graph) {
      router=createRouter(routerId,graph);
      routers.put(routerId,router);
    }
    return router;
  }
}
