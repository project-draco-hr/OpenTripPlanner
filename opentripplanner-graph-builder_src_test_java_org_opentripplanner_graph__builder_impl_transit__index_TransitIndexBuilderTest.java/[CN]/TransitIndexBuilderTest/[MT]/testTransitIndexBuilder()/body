{
  Graph graph=new Graph();
  File testGtfs=new File("../opentripplanner-routing/src/test/resources/testagency.zip");
  GtfsBundle bundle=new GtfsBundle();
  bundle.setPath(testGtfs);
  GtfsBundles bundles=new GtfsBundles();
  bundles.setBundles(Arrays.asList(bundle));
  GtfsGraphBuilderImpl gtfsBuilder=new GtfsGraphBuilderImpl();
  gtfsBuilder.setGtfsBundles(bundles);
  TransitIndexBuilder builder=new TransitIndexBuilder();
  List<GraphBuilderWithGtfsDao> builders=new ArrayList<GraphBuilderWithGtfsDao>();
  builders.add(builder);
  gtfsBuilder.setGtfsGraphBuilders(builders);
  gtfsBuilder.buildGraph(graph,new HashMap<Class<?>,Object>());
  TransitIndexService index=graph.getService(TransitIndexService.class);
  assertNotNull(index);
  Edge prealightEdge=index.getPreAlightEdge(new AgencyAndId("agency","A"));
  assertTrue(prealightEdge instanceof PreAlightEdge);
  List<RouteVariant> variantsForRoute=index.getVariantsForRoute(new AgencyAndId("agency","18"));
  assertEquals(2,variantsForRoute.size());
  Collection<String> directionsForRoute=index.getDirectionsForRoute(new AgencyAndId("agency","18"));
  assertEquals(2,directionsForRoute.size());
  variantsForRoute=index.getVariantsForRoute(new AgencyAndId("agency","2"));
  assertEquals(1,variantsForRoute.size());
  directionsForRoute=index.getDirectionsForRoute(new AgencyAndId("agency","2"));
  assertEquals(1,directionsForRoute.size());
  assertEquals(null,directionsForRoute.iterator().next());
}
