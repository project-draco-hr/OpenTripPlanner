{
  ArrayList<Hop> hops=new ArrayList<Hop>();
  boolean tripWheelchairAccessible=trip.getWheelchairAccessible() == 1;
  PatternStopVertex psv0arrive, psv0depart, psv1arrive=null;
  ArrayList<Edge> created=new ArrayList<Edge>();
  for (int i=0; i < stopTimes.size() - 1; i++) {
    StopTime st0=stopTimes.get(i);
    Stop s0=st0.getStop();
    StopTime st1=stopTimes.get(i + 1);
    Stop s1=st1.getStop();
    int dwellTime=st0.getDepartureTime() - st0.getArrivalTime();
    int runningTime=st1.getArrivalTime() - st0.getDepartureTime();
    if (runningTime < 0) {
      _log.warn(GraphBuilderAnnotation.register(graph,Variety.NEGATIVE_HOP_TIME,st0,st1));
      for (      Edge e : created) {
        e.getFromVertex().removeOutgoing(e);
        e.getToVertex().removeIncoming(e);
      }
      return;
    }
    if (dwellTime < 0) {
      _log.warn(GraphBuilderAnnotation.register(graph,Variety.NEGATIVE_DWELL_TIME,st0));
      dwellTime=0;
    }
    Vertex startStation=context.stopDepartNodes.get(s0);
    Vertex endStation=context.stopArriveNodes.get(s1);
    if (psv1arrive == null) {
      psv0arrive=new PatternArriveVertex(graph,trip,st0);
    }
 else {
      psv0arrive=psv1arrive;
    }
    psv0depart=new PatternDepartVertex(graph,trip,st0);
    psv1arrive=new PatternArriveVertex(graph,trip,st1);
    new Dwell(psv0arrive,psv0depart,st0);
    Hop hop=new Hop(psv0depart,psv1arrive,st0,st1,trip);
    created.add(hop);
    hop.setGeometry(getHopGeometry(graph,trip.getShapeId(),st0,st1,psv0depart,psv1arrive));
    hops.add(hop);
    if (st0.getPickupType() != 1) {
      Edge board=new Board(startStation,psv0depart,hop,tripWheelchairAccessible && s0.getWheelchairBoarding() == 1,st0.getStop().getZoneId(),trip,st0.getPickupType());
      created.add(board);
    }
    if (st0.getDropOffType() != 1) {
      Edge alight=new Alight(psv1arrive,endStation,hop,tripWheelchairAccessible && s1.getWheelchairBoarding() == 1,st0.getStop().getZoneId(),trip,st0.getDropOffType());
      created.add(alight);
    }
  }
}
