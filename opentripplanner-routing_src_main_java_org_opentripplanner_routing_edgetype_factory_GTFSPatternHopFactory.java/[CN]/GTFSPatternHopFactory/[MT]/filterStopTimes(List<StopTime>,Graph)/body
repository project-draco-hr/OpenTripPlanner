{
  if (stopTimes.size() < 2)   return;
  StopTime st0=stopTimes.get(0);
  if (!st0.isDepartureTimeSet() && st0.isArrivalTimeSet()) {
    st0.setDepartureTime(st0.getArrivalTime());
  }
  for (int i=1; i < stopTimes.size(); i++) {
    boolean st1bogus=false;
    boolean midnightCrossed=false;
    StopTime st1=stopTimes.get(i);
    if (!st1.isDepartureTimeSet() && st1.isArrivalTimeSet()) {
      st1.setDepartureTime(st1.getArrivalTime());
    }
    if (!(st1.isArrivalTimeSet() && st1.isDepartureTimeSet())) {
      continue;
    }
    final int HOUR=60 * 60;
    int dwellTime=st0.getDepartureTime() - st0.getArrivalTime();
    if (dwellTime < 0) {
      _log.warn(GraphBuilderAnnotation.register(graph,Variety.NEGATIVE_DWELL_TIME,st0));
    }
    int runningTime=st1.getArrivalTime() - st0.getDepartureTime();
    if (runningTime < 0) {
      _log.warn(GraphBuilderAnnotation.register(graph,Variety.NEGATIVE_HOP_TIME,st0,st1));
    }
    double hopDistance=DistanceLibrary.fastDistance(st0.getStop().getLon(),st0.getStop().getLat(),st1.getStop().getLon(),st1.getStop().getLat());
    double hopSpeed=hopDistance / runningTime;
    if (st0.getArrivalTime() == st1.getArrivalTime() || st0.getDepartureTime() == st1.getDepartureTime()) {
      _log.trace("{} {}",st0,st1);
      _log.trace(GraphBuilderAnnotation.register(graph,Variety.HOP_ZERO_TIME,hopDistance,st1.getTrip().getRoute(),st1.getTrip().getId(),st1.getStopSequence()));
      st1bogus=true;
    }
 else     if (hopSpeed > 45) {
      _log.trace(GraphBuilderAnnotation.register(graph,Variety.HOP_SPEED_FAST,hopSpeed,hopDistance,st0.getTrip().getRoute(),st0.getTrip().getId(),st0.getStopSequence()));
    }
 else     if (hopSpeed < 0.1) {
      _log.trace(GraphBuilderAnnotation.register(graph,Variety.HOP_SPEED_SLOW,hopSpeed,hopDistance,st0.getTrip().getRoute(),st0.getTrip().getId(),st0.getStopSequence()));
    }
    if (!st1bogus)     st0=st1;
  }
}
