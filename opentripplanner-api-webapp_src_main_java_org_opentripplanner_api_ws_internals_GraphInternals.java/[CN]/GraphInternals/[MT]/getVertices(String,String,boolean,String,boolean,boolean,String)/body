{
  initIndexes(routerId);
  if (className != null && className.equals(""))   className=null;
  Envelope envelope=getEnvelope(lowerLeft,upperRight);
  STRtree vertexIndex=vertexIndices.get(routerId);
  @SuppressWarnings("unchecked") List<Vertex> query=vertexIndex.query(envelope);
  List<Vertex> filtered=new ArrayList<Vertex>();
  for (  Vertex v : query) {
    if (skipTransit && v instanceof TransitVertex)     continue;
    if (skipStreets && v instanceof StreetVertex)     continue;
    if (className != null && !v.getClass().getName().endsWith("." + className))     continue;
    filtered.add(v);
  }
  if (pointsOnly) {
    SimpleVertexSet out=new SimpleVertexSet();
    out.vertices=new ArrayList<SimpleVertex>(filtered.size());
    for (    Vertex v : filtered) {
      out.vertices.add(new SimpleVertex(v));
    }
    return out;
  }
 else {
    VertexSet out=new VertexSet();
    out.vertices=filtered;
    Graph graph=graphService.getGraph(routerId);
    return out.withGraph(graph);
  }
}
