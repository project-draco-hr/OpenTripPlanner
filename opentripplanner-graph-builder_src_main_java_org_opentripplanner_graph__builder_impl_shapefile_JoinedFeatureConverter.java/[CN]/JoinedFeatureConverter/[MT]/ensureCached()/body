{
  if (cache != null) {
    return;
  }
  cache=new HashMap<String,SimpleFeature>();
  try {
    FeatureCollection<SimpleFeatureType,SimpleFeature> features=joinedSource.getFeatures();
    Iterator<SimpleFeature> it=features.iterator();
    while (it.hasNext()) {
      SimpleFeature feature=it.next();
      String joinedKeyValue=toHashableString(feature.getAttribute(joinedKey));
      if (joinedKeyValue != null) {
        cache.put(joinedKeyValue,feature);
      }
 else {
        log.warn("Feature " + feature.getID() + " has null value for its joinedKey ("+ joinedKey+ ")");
      }
    }
    features.close(it);
  }
 catch (  IOException e) {
    throw new RuntimeException("Could not cache values for joined shapefile",e);
  }
}
