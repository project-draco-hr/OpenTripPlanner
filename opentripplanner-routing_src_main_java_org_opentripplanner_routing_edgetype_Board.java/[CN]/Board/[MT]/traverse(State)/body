{
  RoutingContext rctx=state0.getContext();
  TraverseOptions options=state0.getOptions();
  if (options.wheelchairAccessible && !wheelchairAccessible) {
    return null;
  }
  if (options.isArriveBy()) {
    StateEditor s1=state0.edit(this);
    s1.setTripId(null);
    s1.setLastAlightedTime(state0.getTime());
    s1.setPreviousStop(fromv);
    TransitUtils.handleBoardAlightType(s1,pickupType);
    return s1.makeState();
  }
 else {
    if (options.bannedTrips.contains(getTrip().getId())) {
      return null;
    }
    TraverseMode mode=state0.getNonTransitMode(options);
    if (!options.getModes().contains(hop.getMode())) {
      return null;
    }
    if (mode.equals(TraverseMode.BICYCLE) && !hop.getBikesAllowed()) {
      return null;
    }
    if (options.wheelchairAccessible && !wheelchairAccessible) {
      return null;
    }
    long current_time=state0.getTime();
    AgencyAndId serviceId=hop.getServiceId();
    int wait=-1;
    for (    ServiceDay sd : rctx.serviceDays) {
      int secondsSinceMidnight=sd.secondsSinceMidnight(current_time);
      if (secondsSinceMidnight < 0)       continue;
      if (sd.serviceIdRunning(serviceId)) {
        int newWait=hop.getStartStopTime().getDepartureTime() - secondsSinceMidnight;
        if (wait < 0 || newWait < wait) {
          wait=newWait;
        }
      }
    }
    if (wait < 0) {
      return null;
    }
    StateEditor s1=state0.edit(this);
    TransitUtils.handleBoardAlightType(s1,pickupType);
    s1.incrementTimeInSeconds(wait);
    s1.incrementWeight(wait * options.waitReluctance + options.getBoardCost(mode));
    s1.incrementNumBoardings();
    s1.setTripId(trip.getId());
    s1.setZone(zone);
    s1.setRoute(trip.getRoute().getId());
    return s1.makeState();
  }
}
