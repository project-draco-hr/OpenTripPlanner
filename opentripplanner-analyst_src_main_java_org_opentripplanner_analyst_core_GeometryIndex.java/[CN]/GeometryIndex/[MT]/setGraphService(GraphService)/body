{
  Graph graph=graphService.getGraph();
  if (graph == null)   return;
  pedestrianIndex=new STRtree();
  index=new STRtree();
  for (  StreetVertex vertex : IterableLibrary.filter(graph.getVertices(),StreetVertex.class)) {
    for (    StreetEdge e : IterableLibrary.filter(vertex.getOutgoing(),StreetEdge.class)) {
      Geometry geom=e.getGeometry();
      if (e.getPermission().allows(StreetTraversalPermission.PEDESTRIAN)) {
        pedestrianIndex.insert(geom.getEnvelopeInternal(),e);
      }
      index.insert(geom.getEnvelopeInternal(),e);
    }
  }
  pedestrianIndex.build();
  index.build();
  LOG.debug("spatial index size: {}",pedestrianIndex.size());
}
