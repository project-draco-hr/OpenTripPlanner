{
  PeriodicTimerGraphUpdater periodicUpdater=graph.getService(PeriodicTimerGraphUpdater.class,true);
  if (config != null) {
    applyConfigurationToGraph(graph,config);
  }
 else {
    EmbeddedConfigService embeddedConfigService=graph.getService(EmbeddedConfigService.class);
    if (embeddedConfigService != null) {
      LOG.info("Decorating graph using embedded config");
      Preferences embeddedConfig=new PropertiesPreferences(embeddedConfigService.getProperties());
      applyConfigurationToGraph(graph,embeddedConfig);
    }
  }
  if (periodicUpdater.size() == 0) {
    graph.putService(PeriodicTimerGraphUpdater.class,null);
  }
}
