{
  StreetVertexIndexService index=new StreetVertexIndexServiceImpl(graph);
  GeometryFactory geometryFactory=GeometryUtils.getGeometryFactory();
  for (  TransitStop ts : IterableLibrary.filter(graph.getVertices(),TransitStop.class)) {
    Coordinate c=ts.getCoordinate();
    LOG.trace("linking stop {}",ts);
    int n=0;
    for (    TransitStop other : index.getNearbyTransitStops(c,radius)) {
      if (!other.isStreetLinkable())       continue;
      Coordinate coordinates[]=new Coordinate[]{c,other.getCoordinate()};
      double distance=distanceLibrary.distance(coordinates[0],coordinates[1]);
      LineString geometry=geometryFactory.createLineString(coordinates);
      LOG.trace("  to stop: {} ({}m)",other,distance);
      new SimpleTransfer(ts,other,distance,geometry);
      n+=1;
    }
    LOG.trace("linked to {} others.",n);
  }
}
