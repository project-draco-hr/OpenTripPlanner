{
  while (true) {
    List<Update> updates=updateStreamer.getUpdates();
    if (updates == null) {
      LOG.debug("updates is null");
      continue;
    }
    List<UpdateBlock> blocks=UpdateBlock.splitByTrip(updates);
    LOG.debug("message contains {} trip update blocks",blocks.size());
    int uIndex=0;
    for (    UpdateBlock updateBlock : blocks) {
      uIndex+=1;
      LOG.debug("update block #{} :",uIndex);
      LOG.trace("{}",updateBlock.toString());
      updateBlock.filter(true,true,true);
      if (!updateBlock.isSane()) {
        LOG.debug("incoherent stoptime UpdateList");
        continue;
      }
      TableTripPattern pattern=patternIndex.get(updateBlock.tripId);
      if (pattern == null) {
        LOG.debug("pattern not found {}",updateBlock.tripId);
        continue;
      }
synchronized (buffer) {
        Timetable tt=buffer.modify(pattern);
        tt.update(updateBlock);
      }
    }
    LOG.debug("end of update message",uIndex);
  }
}
