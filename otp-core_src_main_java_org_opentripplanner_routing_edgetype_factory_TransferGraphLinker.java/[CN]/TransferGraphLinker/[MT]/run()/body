{
  Map<AgencyAndId,TransitStopArrive> stopArriveNodes=new HashMap<AgencyAndId,TransitStopArrive>();
  Map<AgencyAndId,TransitStopDepart> stopDepartNodes=new HashMap<AgencyAndId,TransitStopDepart>();
  for (  Vertex v : graph.getVertices()) {
    if (v instanceof TransitStopArrive) {
      TransitStopArrive transitStop=(TransitStopArrive)v;
      Stop stop=transitStop.getStop();
      stopArriveNodes.put(stop.getId(),transitStop);
    }
 else     if (v instanceof TransitStopDepart) {
      TransitStopDepart transitStop=(TransitStopDepart)v;
      Stop stop=transitStop.getStop();
      stopDepartNodes.put(stop.getId(),transitStop);
    }
  }
  for (  TransferTable.Transfer transfer : graph.getTransferTable().getAllFirstSpecificTransfers()) {
    Vertex fromVertex=stopArriveNodes.get(transfer.fromStopId);
    Vertex toVertex=stopDepartNodes.get(transfer.toStopId);
    double distance=distanceLibrary.distance(fromVertex.getCoordinate(),toVertex.getCoordinate());
    TransferEdge edge=null;
switch (transfer.seconds) {
case StopTransfer.FORBIDDEN_TRANSFER:
case StopTransfer.UNKNOWN_TRANSFER:
      break;
case StopTransfer.PREFERRED_TRANSFER:
case StopTransfer.TIMED_TRANSFER:
    edge=new TransferEdge(fromVertex,toVertex,distance);
  break;
default :
edge=new TransferEdge(fromVertex,toVertex,distance,transfer.seconds);
}
if (edge != null) {
LineString geometry=GeometryUtils.getGeometryFactory().createLineString(new Coordinate[]{fromVertex.getCoordinate(),toVertex.getCoordinate()});
edge.setGeometry(geometry);
}
}
}
